<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Dataset2_separate</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Dataset2_separate_files/libs/clipboard/clipboard.min.js"></script>
<script src="Dataset2_separate_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="Dataset2_separate_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="Dataset2_separate_files/libs/quarto-html/popper.min.js"></script>
<script src="Dataset2_separate_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Dataset2_separate_files/libs/quarto-html/anchor.min.js"></script>
<link href="Dataset2_separate_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Dataset2_separate_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Dataset2_separate_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Dataset2_separate_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Dataset2_separate_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Dataset2_separate</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(WGCNA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Paket 'WGCNA' wurde unter R Version 4.5.2 erstellt</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Lade nötiges Paket: dynamicTreeCut</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Paket 'dynamicTreeCut' wurde unter R Version 4.5.2 erstellt</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Lade nötiges Paket: fastcluster</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Paket 'fastcluster' wurde unter R Version 4.5.2 erstellt</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attache Paket: 'fastcluster'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Das folgende Objekt ist maskiert 'package:stats':

    hclust</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attache Paket: 'WGCNA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Das folgende Objekt ist maskiert 'package:stats':

    cor</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">disableWGCNAThreads</span>()</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>ctrl_lme <span class="ot">&lt;-</span> nlme<span class="sc">::</span><span class="fu">lmeControl</span>(</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">singular.ok   =</span> <span class="cn">TRUE</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">returnObject  =</span> <span class="cn">TRUE</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">opt           =</span> <span class="st">"optim"</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">msMaxIter     =</span> <span class="dv">200</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxIter       =</span> <span class="dv">200</span>,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">niterEM       =</span> <span class="dv">50</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Load + pheno</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>infile <span class="ot">&lt;-</span> <span class="st">"GSE62043_clean_noOutliers_20251223.RData"</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Loading: "</span>, infile)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading: GSE62043_clean_noOutliers_20251223.RData</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(infile)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>datExpr <span class="ot">&lt;-</span> datExpr0</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">identical</span>(<span class="fu">rownames</span>(datExpr), <span class="fu">rownames</span>(sample_info)))</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>pheno <span class="ot">&lt;-</span> sample_info</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"patient_id"</span>,<span class="st">"tumour"</span>,<span class="st">"Age"</span>,<span class="st">"Gender"</span>) <span class="sc">%in%</span> <span class="fu">colnames</span>(pheno)))</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="st">"condition"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(pheno))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># QC + split</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>gsg <span class="ot">&lt;-</span> <span class="fu">goodSamplesGenes</span>(datExpr, <span class="at">verbose =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Flagging genes and samples with too many missing values...
  ..step 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(gsg<span class="sc">$</span>allOK)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(pheno<span class="sc">$</span>condition)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
normal  tumor 
    93     93 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>datExpr_tumor  <span class="ot">&lt;-</span> datExpr[pheno<span class="sc">$</span>condition <span class="sc">==</span> <span class="st">"tumor"</span>, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>datExpr_normal <span class="ot">&lt;-</span> datExpr[pheno<span class="sc">$</span>condition <span class="sc">==</span> <span class="st">"normal"</span>, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">identical</span>(<span class="fu">colnames</span>(datExpr_tumor), <span class="fu">colnames</span>(datExpr_normal)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Soft power</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>powers <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>networkType <span class="ot">&lt;-</span> <span class="st">"unsigned"</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>sft_tumor  <span class="ot">&lt;-</span> <span class="fu">pickSoftThreshold</span>(datExpr_tumor,  <span class="at">powerVector =</span> powers, <span class="at">networkType =</span> networkType, <span class="at">verbose =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>pickSoftThreshold: will use block size 2283.
 pickSoftThreshold: calculating connectivity for given powers...
   ..working on genes 1 through 2283 of 19595
   ..working on genes 2284 through 4566 of 19595
   ..working on genes 4567 through 6849 of 19595
   ..working on genes 6850 through 9132 of 19595
   ..working on genes 9133 through 11415 of 19595
   ..working on genes 11416 through 13698 of 19595
   ..working on genes 13699 through 15981 of 19595
   ..working on genes 15982 through 18264 of 19595
   ..working on genes 18265 through 19595 of 19595
   Power SFT.R.sq  slope truncated.R.sq  mean.k. median.k. max.k.
1      1  0.00385 -0.254          0.949 2730.000  2.69e+03 4540.0
2      2  0.43300 -1.840          0.961  623.000  5.78e+02 1670.0
3      3  0.72500 -2.270          0.983  189.000  1.56e+02  796.0
4      4  0.84000 -2.340          0.994   69.900  4.90e+01  453.0
5      5  0.88600 -2.240          0.996   30.400  1.73e+01  286.0
6      6  0.90300 -2.100          0.995   15.000  6.72e+00  193.0
7      7  0.91200 -1.960          0.993    8.250  2.85e+00  137.0
8      8  0.92300 -1.830          0.993    4.930  1.29e+00  100.0
9      9  0.93200 -1.720          0.991    3.150  6.26e-01   75.7
10    10  0.93400 -1.650          0.991    2.120  3.14e-01   59.0
11    11  0.93800 -1.590          0.990    1.500  1.64e-01   46.8
12    12  0.92400 -1.580          0.986    1.090  8.82e-02   39.4
13    13  0.87500 -1.610          0.961    0.818  4.88e-02   33.5
14    14  0.84300 -1.630          0.949    0.629  2.76e-02   28.6
15    15  0.84900 -1.610          0.956    0.494  1.60e-02   24.6
16    16  0.85100 -1.600          0.962    0.394  9.44e-03   21.3
17    17  0.85000 -1.590          0.961    0.320  5.63e-03   18.5
18    18  0.87700 -1.540          0.969    0.263  3.39e-03   16.2
19    19  0.87400 -1.530          0.968    0.219  2.08e-03   14.2
20    20  0.87900 -1.520          0.970    0.184  1.28e-03   12.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>sft_normal <span class="ot">&lt;-</span> <span class="fu">pickSoftThreshold</span>(datExpr_normal, <span class="at">powerVector =</span> powers, <span class="at">networkType =</span> networkType, <span class="at">verbose =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>pickSoftThreshold: will use block size 2283.
 pickSoftThreshold: calculating connectivity for given powers...
   ..working on genes 1 through 2283 of 19595
   ..working on genes 2284 through 4566 of 19595
   ..working on genes 4567 through 6849 of 19595
   ..working on genes 6850 through 9132 of 19595
   ..working on genes 9133 through 11415 of 19595
   ..working on genes 11416 through 13698 of 19595
   ..working on genes 13699 through 15981 of 19595
   ..working on genes 15982 through 18264 of 19595
   ..working on genes 18265 through 19595 of 19595
   Power SFT.R.sq slope truncated.R.sq  mean.k. median.k. max.k.
1      1   0.0154  0.35          0.858 3180.000  3.19e+03 5160.0
2      2   0.2720 -0.89          0.882  846.000  7.97e+02 2010.0
3      3   0.5780 -1.48          0.921  294.000  2.48e+02 1020.0
4      4   0.7120 -1.80          0.946  122.000  8.91e+01  592.0
5      5   0.7910 -1.89          0.968   58.100  3.56e+01  378.0
6      6   0.8360 -1.90          0.978   30.500  1.55e+01  257.0
7      7   0.8600 -1.88          0.985   17.300  7.12e+00  185.0
8      8   0.8760 -1.87          0.988   10.400  3.44e+00  139.0
9      9   0.8830 -1.85          0.989    6.630  1.74e+00  107.0
10    10   0.8880 -1.83          0.990    4.390  9.24e-01   84.3
11    11   0.8940 -1.80          0.991    3.000  5.04e-01   67.7
12    12   0.9010 -1.78          0.994    2.120  2.83e-01   55.2
13    13   0.9000 -1.77          0.991    1.530  1.62e-01   45.5
14    14   0.9010 -1.77          0.995    1.130  9.51e-02   38.0
15    15   0.9030 -1.75          0.994    0.847  5.62e-02   32.0
16    16   0.9030 -1.75          0.994    0.646  3.41e-02   27.2
17    17   0.9090 -1.74          0.994    0.500  2.09e-02   23.2
18    18   0.9060 -1.73          0.991    0.392  1.29e-02   20.0
19    19   0.9080 -1.73          0.996    0.311  8.14e-03   17.3
20    20   0.9110 -1.72          0.996    0.249  5.16e-03   15.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>choosePower <span class="ot">&lt;-</span> <span class="cf">function</span>(sft) {</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  fi <span class="ot">&lt;-</span> sft<span class="sc">$</span>fitIndices</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  r2 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">sign</span>(fi[,<span class="dv">3</span>]) <span class="sc">*</span> fi[,<span class="dv">2</span>]</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  ok <span class="ot">&lt;-</span> <span class="fu">which</span>(r2 <span class="sc">&gt;=</span> <span class="fl">0.90</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(ok)) fi[ok[<span class="dv">1</span>], <span class="dv">1</span>] <span class="cf">else</span> fi[<span class="fu">which.max</span>(r2), <span class="dv">1</span>]</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>softPower_tumor  <span class="ot">&lt;-</span> <span class="fu">choosePower</span>(sft_tumor)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>softPower_normal <span class="ot">&lt;-</span> <span class="fu">choosePower</span>(sft_normal)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>softPower_cons   <span class="ot">&lt;-</span> <span class="fu">min</span>(softPower_tumor, softPower_normal)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Powers: tumor="</span>, softPower_tumor,</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">" normal="</span>, softPower_normal, <span class="st">" cons="</span>, softPower_cons)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Powers: tumor=6 normal=12 cons=6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sft_tumor<span class="sc">$</span>fitIndices[,<span class="dv">1</span>],  <span class="sc">-</span><span class="fu">sign</span>(sft_tumor<span class="sc">$</span>fitIndices[,<span class="dv">3</span>]) <span class="sc">*</span> sft_tumor<span class="sc">$</span>fitIndices[,<span class="dv">2</span>],</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Power"</span>, <span class="at">ylab=</span><span class="st">"R^2"</span>, <span class="at">type=</span><span class="st">"n"</span>, <span class="at">main=</span><span class="st">"Tumor R^2"</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(sft_tumor<span class="sc">$</span>fitIndices[,<span class="dv">1</span>], <span class="sc">-</span><span class="fu">sign</span>(sft_tumor<span class="sc">$</span>fitIndices[,<span class="dv">3</span>]) <span class="sc">*</span> sft_tumor<span class="sc">$</span>fitIndices[,<span class="dv">2</span>],</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">labels=</span>powers, <span class="at">cex=</span><span class="fl">0.8</span>, <span class="at">col=</span><span class="st">"red"</span>); <span class="fu">abline</span>(<span class="at">h=</span><span class="fl">0.9</span>, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sft_tumor<span class="sc">$</span>fitIndices[,<span class="dv">1</span>], sft_tumor<span class="sc">$</span>fitIndices[,<span class="dv">5</span>],</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Power"</span>, <span class="at">ylab=</span><span class="st">"k"</span>, <span class="at">type=</span><span class="st">"n"</span>, <span class="at">main=</span><span class="st">"Tumor k"</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(sft_tumor<span class="sc">$</span>fitIndices[,<span class="dv">1</span>], sft_tumor<span class="sc">$</span>fitIndices[,<span class="dv">5</span>], <span class="at">labels=</span>powers, <span class="at">cex=</span><span class="fl">0.8</span>, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sft_normal<span class="sc">$</span>fitIndices[,<span class="dv">1</span>],  <span class="sc">-</span><span class="fu">sign</span>(sft_normal<span class="sc">$</span>fitIndices[,<span class="dv">3</span>]) <span class="sc">*</span> sft_normal<span class="sc">$</span>fitIndices[,<span class="dv">2</span>],</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Power"</span>, <span class="at">ylab=</span><span class="st">"R^2"</span>, <span class="at">type=</span><span class="st">"n"</span>, <span class="at">main=</span><span class="st">"Normal R^2"</span>)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(sft_normal<span class="sc">$</span>fitIndices[,<span class="dv">1</span>], <span class="sc">-</span><span class="fu">sign</span>(sft_normal<span class="sc">$</span>fitIndices[,<span class="dv">3</span>]) <span class="sc">*</span> sft_normal<span class="sc">$</span>fitIndices[,<span class="dv">2</span>],</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">labels=</span>powers, <span class="at">cex=</span><span class="fl">0.8</span>, <span class="at">col=</span><span class="st">"red"</span>); <span class="fu">abline</span>(<span class="at">h=</span><span class="fl">0.9</span>, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sft_normal<span class="sc">$</span>fitIndices[,<span class="dv">1</span>], sft_normal<span class="sc">$</span>fitIndices[,<span class="dv">5</span>],</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Power"</span>, <span class="at">ylab=</span><span class="st">"k"</span>, <span class="at">type=</span><span class="st">"n"</span>, <span class="at">main=</span><span class="st">"Normal k"</span>)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(sft_normal<span class="sc">$</span>fitIndices[,<span class="dv">1</span>], sft_normal<span class="sc">$</span>fitIndices[,<span class="dv">5</span>], <span class="at">labels=</span>powers, <span class="at">cex=</span><span class="fl">0.8</span>, <span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Dataset2_separate_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper WGCNA</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>run_single_wgcna <span class="ot">&lt;-</span> <span class="cf">function</span>(datExpr_subset,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">softPower =</span> <span class="dv">7</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">minModuleSize =</span> <span class="dv">70</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>                             <span class="at">deepSplit =</span> <span class="dv">2</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>                             <span class="at">mergeCutHeight =</span> <span class="fl">0.25</span>,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">networkType =</span> <span class="st">"unsigned"</span>,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>                             <span class="at">maxBlockSize =</span> <span class="dv">12000</span>) {</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  nG <span class="ot">&lt;-</span> <span class="fu">ncol</span>(datExpr_subset)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  use_blockwise <span class="ot">&lt;-</span> nG <span class="sc">&gt;</span> maxBlockSize</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (use_blockwise) {</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    net <span class="ot">&lt;-</span> <span class="fu">blockwiseModules</span>(</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>      datExpr_subset,</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">power =</span> softPower,</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">networkType =</span> networkType,</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">TOMType =</span> networkType,</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">minModuleSize =</span> minModuleSize,</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">deepSplit =</span> deepSplit,</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">pamRespectsDendro =</span> <span class="cn">FALSE</span>,</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">mergeCutHeight =</span> mergeCutHeight,</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">numericLabels =</span> <span class="cn">FALSE</span>,</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">maxBlockSize =</span> maxBlockSize,</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">saveTOMs =</span> <span class="cn">FALSE</span>,</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">verbose =</span> <span class="dv">3</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">moduleColors =</span> net<span class="sc">$</span>colors, <span class="at">MEs =</span> <span class="fu">orderMEs</span>(net<span class="sc">$</span>MEs), <span class="at">geneTree =</span> net<span class="sc">$</span>dendrograms)</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    adjacency_mat <span class="ot">&lt;-</span> <span class="fu">adjacency</span>(datExpr_subset, <span class="at">power =</span> softPower, <span class="at">type =</span> networkType)</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>    TOM <span class="ot">&lt;-</span> <span class="fu">TOMsimilarity</span>(adjacency_mat, <span class="at">TOMType =</span> networkType)</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>    dissTOM <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> TOM</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>    geneTree <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">as.dist</span>(dissTOM), <span class="at">method =</span> <span class="st">"average"</span>)</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>    dynamicMods <span class="ot">&lt;-</span> <span class="fu">cutreeDynamic</span>(</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">dendro =</span> geneTree,</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">distM =</span> dissTOM,</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">deepSplit =</span> deepSplit,</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">pamRespectsDendro =</span> <span class="cn">FALSE</span>,</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">minClusterSize =</span> minModuleSize</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>    dynamicColors <span class="ot">&lt;-</span> <span class="fu">labels2colors</span>(dynamicMods)</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>    merge <span class="ot">&lt;-</span> <span class="fu">mergeCloseModules</span>(datExpr_subset, dynamicColors, <span class="at">cutHeight =</span> mergeCutHeight, <span class="at">verbose =</span> <span class="dv">0</span>)</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">moduleColors =</span> merge<span class="sc">$</span>colors, <span class="at">MEs =</span> <span class="fu">orderMEs</span>(merge<span class="sc">$</span>newMEs), <span class="at">geneTree =</span> geneTree)</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Consensus modules</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>multiExpr_cons <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Tumor  =</span> <span class="fu">list</span>(<span class="at">data =</span> datExpr_tumor),</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Normal =</span> <span class="fu">list</span>(<span class="at">data =</span> datExpr_normal)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>consensus_net <span class="ot">&lt;-</span> <span class="fu">blockwiseConsensusModules</span>(</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  multiExpr_cons,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">power =</span> softPower_cons,</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">networkType =</span> networkType,</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">TOMType =</span> networkType,</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">minModuleSize =</span> <span class="dv">70</span>,</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">deepSplit =</span> <span class="dv">2</span>,</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">pamRespectsDendro =</span> <span class="cn">FALSE</span>,</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">mergeCutHeight =</span> <span class="fl">0.25</span>,</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">numericLabels =</span> <span class="cn">FALSE</span>,</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxBlockSize =</span> <span class="dv">12000</span>,</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">saveTOMs =</span> <span class="cn">FALSE</span>,</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="dv">3</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Calculating consensus modules and module eigengenes block-wise from all genes
 Calculating topological overlaps block-wise from all genes
   Flagging genes and samples with too many missing values...
    ..step 1
 ....pre-clustering genes to determine blocks..
   Consensus projective K-means:
   ..consensus k-means clustering..
   ..merging smaller clusters...
 ..Working on block 1 .
 ....Working on set 1
    TOM calculation: adjacency..
    ..will not use multithreading.
     Fraction of slow calculations: 0.000000
    ..connectivity..
    ..matrix multiplication (system BLAS)..
    ..normalization..
    ..done.
 ....Working on set 2
    TOM calculation: adjacency..
    ..will not use multithreading.
     Fraction of slow calculations: 0.000000
    ..connectivity..
    ..matrix multiplication (system BLAS)..
    ..normalization..
    ..done.
 ..Working on block 2 .
 ....Working on set 1
    TOM calculation: adjacency..
    ..will not use multithreading.
     Fraction of slow calculations: 0.000000
    ..connectivity..
    ..matrix multiplication (system BLAS)..
    ..normalization..
    ..done.
 ....Working on set 2
    TOM calculation: adjacency..
    ..will not use multithreading.
     Fraction of slow calculations: 0.000000
    ..connectivity..
    ..matrix multiplication (system BLAS)..
    ..normalization..
    ..done.
 ..Working on block 1 .
 ....clustering and detecting modules..
 ....calculating eigengenes..
 ....checking consensus modules for statistical meaningfulness..
 ..Working on block 2 .
 ....clustering and detecting modules..
 ....calculating eigengenes..
 ....checking consensus modules for statistical meaningfulness..
 ....checking for genes that should be reassigned..
 ..merging consensus modules that are too close..
     mergeCloseModules: Merging modules whose distance is less than 0.25
       Calculating new MEs...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>consensus_colors <span class="ot">&lt;-</span> <span class="fu">setNames</span>(consensus_net<span class="sc">$</span>colors, <span class="fu">colnames</span>(datExpr_tumor))</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">identical</span>(<span class="fu">names</span>(consensus_colors), <span class="fu">colnames</span>(datExpr_normal)))</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(consensus_colors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>consensus_colors
       black         blue        brown         cyan        green  greenyellow 
         475         2444         1338          148          805          210 
        grey    lightcyan      magenta midnightblue         pink       purple 
        8044          102          275          114          425          235 
         red       salmon          tan    turquoise       yellow 
         655          170          178         3033          944 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>ME_cons_tumor  <span class="ot">&lt;-</span> <span class="fu">orderMEs</span>(<span class="fu">moduleEigengenes</span>(datExpr_tumor,  <span class="at">colors =</span> consensus_colors)<span class="sc">$</span>eigengenes)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>ME_cons_normal <span class="ot">&lt;-</span> <span class="fu">orderMEs</span>(<span class="fu">moduleEigengenes</span>(datExpr_normal, <span class="at">colors =</span> consensus_colors)<span class="sc">$</span>eigengenes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LMM on consensus MEs</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>pheno<span class="sc">$</span>patient_id <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(pheno<span class="sc">$</span>patient_id)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>pheno<span class="sc">$</span>Gender     <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(pheno<span class="sc">$</span>Gender)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>pheno<span class="sc">$</span>Age        <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(pheno<span class="sc">$</span>Age)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>sampleTraits <span class="ot">&lt;-</span> pheno[, <span class="fu">c</span>(<span class="st">"patient_id"</span>,<span class="st">"tumour"</span>,<span class="st">"Age"</span>,<span class="st">"Gender"</span>)]</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(sampleTraits) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(pheno)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>ME_cons_all <span class="ot">&lt;-</span> <span class="fu">orderMEs</span>(<span class="fu">moduleEigengenes</span>(datExpr, <span class="at">colors =</span> consensus_colors)<span class="sc">$</span>eigengenes)</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>datLMM_cons <span class="ot">&lt;-</span> <span class="fu">cbind</span>(sampleTraits[<span class="fu">rownames</span>(ME_cons_all), ], <span class="fu">as.data.frame</span>(ME_cons_all))</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>modNames_cons <span class="ot">&lt;-</span> <span class="fu">colnames</span>(ME_cons_all)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>cons_lmm <span class="ot">&lt;-</span> <span class="fu">lapply</span>(modNames_cons, <span class="cf">function</span>(mn) {</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  form <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(mn, <span class="st">"~ tumour + Age + Gender"</span>))</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lme</span>(form, <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> patient_id, <span class="at">data =</span> datLMM_cons,</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">na.action =</span> na.omit, <span class="at">method =</span> <span class="st">"REML"</span>, <span class="at">control =</span> ctrl_lme),</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NULL</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(fit)) {</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">module =</span> mn, <span class="at">beta_tumour =</span> <span class="cn">NA</span>, <span class="at">t_tumour =</span> <span class="cn">NA</span>, <span class="at">p_tumour =</span> <span class="cn">NA</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>    sm <span class="ot">&lt;-</span> <span class="fu">summary</span>(fit)</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>    tr <span class="ot">&lt;-</span> sm<span class="sc">$</span>tTable[<span class="st">"tumour"</span>, ]</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">module =</span> mn,</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">beta_tumour =</span> <span class="fu">unname</span>(tr[<span class="st">"Value"</span>]),</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">t_tumour    =</span> <span class="fu">unname</span>(tr[<span class="st">"t-value"</span>]),</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">p_tumour    =</span> <span class="fu">unname</span>(tr[<span class="st">"p-value"</span>]),</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>cons_lmm_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, cons_lmm)</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>cons_lmm_df<span class="sc">$</span>padj_BH <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(cons_lmm_df<span class="sc">$</span>p_tumour, <span class="at">method =</span> <span class="st">"BH"</span>)</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>cons_lmm_df <span class="ot">&lt;-</span> cons_lmm_df[<span class="fu">order</span>(cons_lmm_df<span class="sc">$</span>p_tumour), ]</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cons_lmm_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           module  beta_tumour    t_tumour     p_tumour      padj_BH
17         MEgrey  0.127104712  24.4719827 4.687807e-42 7.969272e-41
4   MEgreenyellow  0.107426021  16.3886888 4.930817e-29 4.191195e-28
9          MEcyan -0.100705880 -13.6928866 6.372989e-24 3.611361e-23
8        MEsalmon -0.098592239 -13.1350507 8.122086e-23 3.451887e-22
6        MEyellow -0.087601691 -10.3817908 3.611612e-17 1.227948e-16
16        MEgreen -0.080938346  -9.8014344 5.972503e-16 1.692209e-15
15        MEbrown -0.080313674  -9.2280816 9.611209e-15 2.334151e-14
7       MEmagenta -0.070497767  -8.1875610 1.464740e-12 3.112572e-12
10          MEred -0.066903523  -7.6292003 2.111069e-11 3.987574e-11
1     MElightcyan  0.059032766   6.3963401 6.531121e-09 1.110291e-08
14        MEblack -0.039570300  -5.0354459 2.361610e-06 3.649762e-06
5  MEmidnightblue  0.049759351   4.8792517 4.451051e-06 6.305655e-06
3           MEtan  0.038495748   4.2881252 4.438230e-05 5.803839e-05
11       MEpurple  0.013178460   4.1063146 8.698753e-05 1.056277e-04
13    MEturquoise -0.004122795  -1.0044780 3.177829e-01 3.601540e-01
2          MEblue  0.008668244   0.9146626 3.627599e-01 3.854324e-01
12         MEpink  0.002914251   0.8264229 4.107024e-01 4.107024e-01</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(cons_lmm_df, <span class="at">file =</span> <span class="st">"GSE62043_consensus_LMM_results.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Consensus preservation</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>multiColor_cons <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">Tumor =</span> consensus_colors, <span class="at">Normal =</span> consensus_colors)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>mp_cons <span class="ot">&lt;-</span> <span class="fu">modulePreservation</span>(</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">multiData =</span> multiExpr_cons,</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">multiColor =</span> multiColor_cons,</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataIsExpr =</span> <span class="cn">TRUE</span>,</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">networkType =</span> networkType,</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">referenceNetworks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">nPermutations =</span> <span class="dv">200</span>,</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">randomSeed =</span> <span class="dv">12345</span>,</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="dv">3</span>,</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallelCalculation =</span> <span class="cn">FALSE</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ..checking data for excessive amounts of missing data..
     Flagging genes and samples with too many missing values...
      ..step 1
     Flagging genes and samples with too many missing values...
      ..step 1
  ..unassigned 'module' name: grey 
  ..all network sample 'module' name: gold
  ..calculating observed preservation values
  ..calculating permutation Z scores
 ..Working with set 1 as reference set
 ....working with set 2 as test set
  ......working on permutation 1
  ......working on permutation 2
  ......working on permutation 3
  ......working on permutation 4
  ......working on permutation 5
  ......working on permutation 6
  ......working on permutation 7
  ......working on permutation 8
  ......working on permutation 9
  ......working on permutation 10
  ......working on permutation 11
  ......working on permutation 12
  ......working on permutation 13
  ......working on permutation 14
  ......working on permutation 15
  ......working on permutation 16
  ......working on permutation 17
  ......working on permutation 18
  ......working on permutation 19
  ......working on permutation 20
  ......working on permutation 21
  ......working on permutation 22
  ......working on permutation 23
  ......working on permutation 24
  ......working on permutation 25
  ......working on permutation 26
  ......working on permutation 27
  ......working on permutation 28
  ......working on permutation 29
  ......working on permutation 30
  ......working on permutation 31
  ......working on permutation 32
  ......working on permutation 33
  ......working on permutation 34
  ......working on permutation 35
  ......working on permutation 36
  ......working on permutation 37
  ......working on permutation 38
  ......working on permutation 39
  ......working on permutation 40
  ......working on permutation 41
  ......working on permutation 42
  ......working on permutation 43
  ......working on permutation 44
  ......working on permutation 45
  ......working on permutation 46
  ......working on permutation 47
  ......working on permutation 48
  ......working on permutation 49
  ......working on permutation 50
  ......working on permutation 51
  ......working on permutation 52
  ......working on permutation 53
  ......working on permutation 54
  ......working on permutation 55
  ......working on permutation 56
  ......working on permutation 57
  ......working on permutation 58
  ......working on permutation 59
  ......working on permutation 60
  ......working on permutation 61
  ......working on permutation 62
  ......working on permutation 63
  ......working on permutation 64
  ......working on permutation 65
  ......working on permutation 66
  ......working on permutation 67
  ......working on permutation 68
  ......working on permutation 69
  ......working on permutation 70
  ......working on permutation 71
  ......working on permutation 72
  ......working on permutation 73
  ......working on permutation 74
  ......working on permutation 75
  ......working on permutation 76
  ......working on permutation 77
  ......working on permutation 78
  ......working on permutation 79
  ......working on permutation 80
  ......working on permutation 81
  ......working on permutation 82
  ......working on permutation 83
  ......working on permutation 84
  ......working on permutation 85
  ......working on permutation 86
  ......working on permutation 87
  ......working on permutation 88
  ......working on permutation 89
  ......working on permutation 90
  ......working on permutation 91
  ......working on permutation 92
  ......working on permutation 93
  ......working on permutation 94
  ......working on permutation 95
  ......working on permutation 96
  ......working on permutation 97
  ......working on permutation 98
  ......working on permutation 99
  ......working on permutation 100
  ......working on permutation 101
  ......working on permutation 102
  ......working on permutation 103
  ......working on permutation 104
  ......working on permutation 105
  ......working on permutation 106
  ......working on permutation 107
  ......working on permutation 108
  ......working on permutation 109
  ......working on permutation 110
  ......working on permutation 111
  ......working on permutation 112
  ......working on permutation 113
  ......working on permutation 114
  ......working on permutation 115
  ......working on permutation 116
  ......working on permutation 117
  ......working on permutation 118
  ......working on permutation 119
  ......working on permutation 120
  ......working on permutation 121
  ......working on permutation 122
  ......working on permutation 123
  ......working on permutation 124
  ......working on permutation 125
  ......working on permutation 126
  ......working on permutation 127
  ......working on permutation 128
  ......working on permutation 129
  ......working on permutation 130
  ......working on permutation 131
  ......working on permutation 132
  ......working on permutation 133
  ......working on permutation 134
  ......working on permutation 135
  ......working on permutation 136
  ......working on permutation 137
  ......working on permutation 138
  ......working on permutation 139
  ......working on permutation 140
  ......working on permutation 141
  ......working on permutation 142
  ......working on permutation 143
  ......working on permutation 144
  ......working on permutation 145
  ......working on permutation 146
  ......working on permutation 147
  ......working on permutation 148
  ......working on permutation 149
  ......working on permutation 150
  ......working on permutation 151
  ......working on permutation 152
  ......working on permutation 153
  ......working on permutation 154
  ......working on permutation 155
  ......working on permutation 156
  ......working on permutation 157
  ......working on permutation 158
  ......working on permutation 159
  ......working on permutation 160
  ......working on permutation 161
  ......working on permutation 162
  ......working on permutation 163
  ......working on permutation 164
  ......working on permutation 165
  ......working on permutation 166
  ......working on permutation 167
  ......working on permutation 168
  ......working on permutation 169
  ......working on permutation 170
  ......working on permutation 171
  ......working on permutation 172
  ......working on permutation 173
  ......working on permutation 174
  ......working on permutation 175
  ......working on permutation 176
  ......working on permutation 177
  ......working on permutation 178
  ......working on permutation 179
  ......working on permutation 180
  ......working on permutation 181
  ......working on permutation 182
  ......working on permutation 183
  ......working on permutation 184
  ......working on permutation 185
  ......working on permutation 186
  ......working on permutation 187
  ......working on permutation 188
  ......working on permutation 189
  ......working on permutation 190
  ......working on permutation 191
  ......working on permutation 192
  ......working on permutation 193
  ......working on permutation 194
  ......working on permutation 195
  ......working on permutation 196
  ......working on permutation 197
  ......working on permutation 198
  ......working on permutation 199
  ......working on permutation 200
 ..Working with set 2 as reference set
 ....working with set 1 as test set
  ......working on permutation 1
  ......working on permutation 2
  ......working on permutation 3
  ......working on permutation 4
  ......working on permutation 5
  ......working on permutation 6
  ......working on permutation 7
  ......working on permutation 8
  ......working on permutation 9
  ......working on permutation 10
  ......working on permutation 11
  ......working on permutation 12
  ......working on permutation 13
  ......working on permutation 14
  ......working on permutation 15
  ......working on permutation 16
  ......working on permutation 17
  ......working on permutation 18
  ......working on permutation 19
  ......working on permutation 20
  ......working on permutation 21
  ......working on permutation 22
  ......working on permutation 23
  ......working on permutation 24
  ......working on permutation 25
  ......working on permutation 26
  ......working on permutation 27
  ......working on permutation 28
  ......working on permutation 29
  ......working on permutation 30
  ......working on permutation 31
  ......working on permutation 32
  ......working on permutation 33
  ......working on permutation 34
  ......working on permutation 35
  ......working on permutation 36
  ......working on permutation 37
  ......working on permutation 38
  ......working on permutation 39
  ......working on permutation 40
  ......working on permutation 41
  ......working on permutation 42
  ......working on permutation 43
  ......working on permutation 44
  ......working on permutation 45
  ......working on permutation 46
  ......working on permutation 47
  ......working on permutation 48
  ......working on permutation 49
  ......working on permutation 50
  ......working on permutation 51
  ......working on permutation 52
  ......working on permutation 53
  ......working on permutation 54
  ......working on permutation 55
  ......working on permutation 56
  ......working on permutation 57
  ......working on permutation 58
  ......working on permutation 59
  ......working on permutation 60
  ......working on permutation 61
  ......working on permutation 62
  ......working on permutation 63
  ......working on permutation 64
  ......working on permutation 65
  ......working on permutation 66
  ......working on permutation 67
  ......working on permutation 68
  ......working on permutation 69
  ......working on permutation 70
  ......working on permutation 71
  ......working on permutation 72
  ......working on permutation 73
  ......working on permutation 74
  ......working on permutation 75
  ......working on permutation 76
  ......working on permutation 77
  ......working on permutation 78
  ......working on permutation 79
  ......working on permutation 80
  ......working on permutation 81
  ......working on permutation 82
  ......working on permutation 83
  ......working on permutation 84
  ......working on permutation 85
  ......working on permutation 86
  ......working on permutation 87
  ......working on permutation 88
  ......working on permutation 89
  ......working on permutation 90
  ......working on permutation 91
  ......working on permutation 92
  ......working on permutation 93
  ......working on permutation 94
  ......working on permutation 95
  ......working on permutation 96
  ......working on permutation 97
  ......working on permutation 98
  ......working on permutation 99
  ......working on permutation 100
  ......working on permutation 101
  ......working on permutation 102
  ......working on permutation 103
  ......working on permutation 104
  ......working on permutation 105
  ......working on permutation 106
  ......working on permutation 107
  ......working on permutation 108
  ......working on permutation 109
  ......working on permutation 110
  ......working on permutation 111
  ......working on permutation 112
  ......working on permutation 113
  ......working on permutation 114
  ......working on permutation 115
  ......working on permutation 116
  ......working on permutation 117
  ......working on permutation 118
  ......working on permutation 119
  ......working on permutation 120
  ......working on permutation 121
  ......working on permutation 122
  ......working on permutation 123
  ......working on permutation 124
  ......working on permutation 125
  ......working on permutation 126
  ......working on permutation 127
  ......working on permutation 128
  ......working on permutation 129
  ......working on permutation 130
  ......working on permutation 131
  ......working on permutation 132
  ......working on permutation 133
  ......working on permutation 134
  ......working on permutation 135
  ......working on permutation 136
  ......working on permutation 137
  ......working on permutation 138
  ......working on permutation 139
  ......working on permutation 140
  ......working on permutation 141
  ......working on permutation 142
  ......working on permutation 143
  ......working on permutation 144
  ......working on permutation 145
  ......working on permutation 146
  ......working on permutation 147
  ......working on permutation 148
  ......working on permutation 149
  ......working on permutation 150
  ......working on permutation 151
  ......working on permutation 152
  ......working on permutation 153
  ......working on permutation 154
  ......working on permutation 155
  ......working on permutation 156
  ......working on permutation 157
  ......working on permutation 158
  ......working on permutation 159
  ......working on permutation 160
  ......working on permutation 161
  ......working on permutation 162
  ......working on permutation 163
  ......working on permutation 164
  ......working on permutation 165
  ......working on permutation 166
  ......working on permutation 167
  ......working on permutation 168
  ......working on permutation 169
  ......working on permutation 170
  ......working on permutation 171
  ......working on permutation 172
  ......working on permutation 173
  ......working on permutation 174
  ......working on permutation 175
  ......working on permutation 176
  ......working on permutation 177
  ......working on permutation 178
  ......working on permutation 179
  ......working on permutation 180
  ......working on permutation 181
  ......working on permutation 182
  ......working on permutation 183
  ......working on permutation 184
  ......working on permutation 185
  ......working on permutation 186
  ......working on permutation 187
  ......working on permutation 188
  ......working on permutation 189
  ......working on permutation 190
  ......working on permutation 191
  ......working on permutation 192
  ......working on permutation 193
  ......working on permutation 194
  ......working on permutation 195
  ......working on permutation 196
  ......working on permutation 197
  ......working on permutation 198
  ......working on permutation 199
  ......working on permutation 200</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(mp_cons, <span class="at">file =</span> <span class="st">"GSE62043_modulePreservation_consensus.RData"</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>Z_tum_in_norm <span class="ot">&lt;-</span> mp_cons<span class="sc">$</span>preservation<span class="sc">$</span>Z<span class="sc">$</span>ref.Tumor<span class="sc">$</span>inColumnsAlsoPresentIn.Normal</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>Z_norm_in_tum <span class="ot">&lt;-</span> mp_cons<span class="sc">$</span>preservation<span class="sc">$</span>Z<span class="sc">$</span>ref.Normal<span class="sc">$</span>inColumnsAlsoPresentIn.Tumor</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Z_tum_in_norm); <span class="fu">head</span>(Z_norm_in_tum)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      moduleSize Zsummary.pres Zdensity.pres Zconnectivity.pres
black        475      49.19364      69.56956           28.81772
blue        1000      61.32218      74.02137           48.62299
brown       1000      52.04498      56.19536           47.89460
cyan         148      31.85622      48.46610           15.24634
gold        1000      29.43121      16.48975           42.37268
green        805      48.33775      49.78057           46.89492
      Z.propVarExplained.pres Z.meanSignAwareKME.pres
black              36.0416048                38.06482
blue               49.9657440                61.29266
brown              41.3751891                71.01553
cyan               30.3146148                27.72928
gold               -0.1807572                33.16025
green              33.5787309                65.98242
      Z.meanSignAwareCorDat.pres Z.meanAdj.pres Z.meanMAR.pres Z.cor.kIM
black                   234.2771    101.0743028      26.067334  16.60543
blue                    468.0852     86.7500680      12.032191  24.98619
brown                   658.7454     39.5456832       1.396731  10.90796
cyan                    134.8925     66.6175784       8.478184   8.98263
gold                    300.9219     -0.5785943      -1.261837  18.70131
green                   634.8630     26.8466157       1.175177  15.91783
      Z.cor.kME Z.cor.kMEall Z.cor.cor Z.cor.MAR
black  28.81772     122.4505 153.36106 18.416260
blue   48.62299     133.7223 318.88463 18.328948
brown  47.89460     146.8663 373.35212 20.733386
cyan   15.24634     121.4077  49.86639  8.358116
gold   42.37268     137.6489 447.82002 21.148751
green  46.89492     130.4450 400.15057 15.268172</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>      moduleSize Zsummary.pres Zdensity.pres Zconnectivity.pres
black        475      90.82465     150.22388           31.42541
blue        1000      49.59133      47.99252           51.19014
brown       1000      51.96584      55.58519           48.34650
cyan         148      61.39279     109.60076           13.18482
gold        1000      28.39513      15.60303           41.18723
green        805      41.28413      42.45363           40.11464
      Z.propVarExplained.pres Z.meanSignAwareKME.pres
black             50.28264348                37.72710
blue              44.52049986                51.46455
brown             46.39460956                64.77577
cyan              40.77077638                29.86986
gold               0.02136917                30.22628
green             28.92874094                55.97852
      Z.meanSignAwareCorDat.pres Z.meanAdj.pres Z.meanMAR.pres Z.cor.kIM
black                   308.9024    250.1651258    32.59590361 16.762030
blue                    497.3558     42.5919370    -0.07384111 25.946839
brown                   836.4013     41.7778013     1.23723384 12.622293
cyan                    178.4307    214.7752538    21.79126730  8.189627
gold                    333.4082      0.9797821     0.49369483 20.859230
green                   532.6075     13.6094231     0.45911850 19.025264
      Z.cor.kME Z.cor.kMEall Z.cor.cor Z.cor.MAR
black  31.42541     114.7980 175.31558 18.448797
blue   51.19014     134.1720 319.94249 18.470633
brown  48.34650     116.1486 472.49383 18.996284
cyan   13.18482     120.6760  54.67722  8.069205
gold   41.18723     131.3646 446.50264 18.586132
green  40.11464     128.5881 387.42378 16.193501</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate networks + preservation</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>tumor_net  <span class="ot">&lt;-</span> <span class="fu">run_single_wgcna</span>(datExpr_tumor,  <span class="at">softPower =</span> softPower_tumor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Calculating module eigengenes block-wise from all genes
   Flagging genes and samples with too many missing values...
    ..step 1
 ....pre-clustering genes to determine blocks..
   Projective K-means:
   ..k-means clustering..
   ..merging smaller clusters...
Block sizes:
gBlocks
    1     2 
10787  8808 
 ..Working on block 1 .
    TOM calculation: adjacency..
    ..will not use multithreading.
     Fraction of slow calculations: 0.000000
    ..connectivity..
    ..matrix multiplication (system BLAS)..
    ..normalization..
    ..done.
 ....clustering..
 ....detecting modules..
 ....calculating module eigengenes..
 ....checking kME in modules..
     ..removing 372 genes from module 1 because their KME is too low.
     ..removing 291 genes from module 2 because their KME is too low.
     ..removing 196 genes from module 3 because their KME is too low.
     ..removing 29 genes from module 4 because their KME is too low.
     ..removing 4 genes from module 5 because their KME is too low.
     ..removing 40 genes from module 6 because their KME is too low.
     ..removing 14 genes from module 7 because their KME is too low.
     ..removing 7 genes from module 8 because their KME is too low.
     ..removing 2 genes from module 9 because their KME is too low.
     ..removing 5 genes from module 10 because their KME is too low.
     ..removing 4 genes from module 12 because their KME is too low.
 ..Working on block 2 .
    TOM calculation: adjacency..
    ..will not use multithreading.
     Fraction of slow calculations: 0.000000
    ..connectivity..
    ..matrix multiplication (system BLAS)..
    ..normalization..
    ..done.
 ....clustering..
 ....detecting modules..
 ....calculating module eigengenes..
 ....checking kME in modules..
     ..removing 349 genes from module 1 because their KME is too low.
     ..removing 30 genes from module 2 because their KME is too low.
     ..removing 55 genes from module 3 because their KME is too low.
     ..removing 39 genes from module 4 because their KME is too low.
     ..removing 36 genes from module 5 because their KME is too low.
     ..removing 3 genes from module 6 because their KME is too low.
  ..reassigning 35 genes from module 1 to modules with higher KME.
  ..reassigning 5 genes from module 2 to modules with higher KME.
  ..reassigning 17 genes from module 3 to modules with higher KME.
  ..reassigning 1 genes from module 5 to modules with higher KME.
  ..reassigning 1 genes from module 6 to modules with higher KME.
  ..reassigning 15 genes from module 13 to modules with higher KME.
  ..reassigning 4 genes from module 14 to modules with higher KME.
  ..reassigning 11 genes from module 15 to modules with higher KME.
  ..reassigning 7 genes from module 16 to modules with higher KME.
  ..reassigning 10 genes from module 17 to modules with higher KME.
  ..reassigning 6 genes from module 18 to modules with higher KME.
  ..reassigning 3 genes from module 19 to modules with higher KME.
  ..reassigning 2 genes from module 21 to modules with higher KME.
  ..reassigning 2 genes from module 22 to modules with higher KME.
 ..merging modules that are too close..
     mergeCloseModules: Merging modules whose distance is less than 0.25
       Calculating new MEs...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>normal_net <span class="ot">&lt;-</span> <span class="fu">run_single_wgcna</span>(datExpr_normal, <span class="at">softPower =</span> softPower_normal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Calculating module eigengenes block-wise from all genes
   Flagging genes and samples with too many missing values...
    ..step 1
 ....pre-clustering genes to determine blocks..
   Projective K-means:
   ..k-means clustering..
   ..merging smaller clusters...
Block sizes:
gBlocks
    1     2 
10603  8992 
 ..Working on block 1 .
    TOM calculation: adjacency..
    ..will not use multithreading.
     Fraction of slow calculations: 0.000000
    ..connectivity..
    ..matrix multiplication (system BLAS)..
    ..normalization..
    ..done.
 ....clustering..
 ....detecting modules..
 ....calculating module eigengenes..
 ....checking kME in modules..
     ..removing 1 genes from module 2 because their KME is too low.
 ..Working on block 2 .
    TOM calculation: adjacency..
    ..will not use multithreading.
     Fraction of slow calculations: 0.000000
    ..connectivity..
    ..matrix multiplication (system BLAS)..
    ..normalization..
    ..done.
 ....clustering..
 ....detecting modules..
 ....calculating module eigengenes..
 ....checking kME in modules..
  ..reassigning 19 genes from module 1 to modules with higher KME.
  ..reassigning 4 genes from module 2 to modules with higher KME.
  ..reassigning 10 genes from module 3 to modules with higher KME.
  ..reassigning 1 genes from module 4 to modules with higher KME.
  ..reassigning 8 genes from module 6 to modules with higher KME.
  ..reassigning 19 genes from module 7 to modules with higher KME.
  ..reassigning 4 genes from module 8 to modules with higher KME.
  ..reassigning 13 genes from module 9 to modules with higher KME.
  ..reassigning 12 genes from module 11 to modules with higher KME.
  ..reassigning 2 genes from module 13 to modules with higher KME.
 ..merging modules that are too close..
     mergeCloseModules: Merging modules whose distance is less than 0.25
       Calculating new MEs...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>tumor_colors  <span class="ot">&lt;-</span> <span class="fu">setNames</span>(tumor_net<span class="sc">$</span>moduleColors,  <span class="fu">colnames</span>(datExpr_tumor))</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>normal_colors <span class="ot">&lt;-</span> <span class="fu">setNames</span>(normal_net<span class="sc">$</span>moduleColors, <span class="fu">colnames</span>(datExpr_normal))</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(tumor_colors); <span class="fu">table</span>(normal_colors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tumor_colors
        black          blue         brown          cyan     darkgreen 
          662          1916          1650           214           119 
      darkred darkturquoise         green   greenyellow          grey 
          125            85          1024           382          5237 
       grey60     lightcyan    lightgreen   lightyellow       magenta 
          190           193           175           141           449 
 midnightblue          pink        purple           red     royalblue 
          204           597           428           668           131 
       salmon           tan     turquoise        yellow 
          313           370          2683          1639 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>normal_colors
      black        blue       brown       green greenyellow        grey 
        302        1655        1397         433         134       12304 
    magenta        pink      purple         red   turquoise      yellow 
        168         270         146         387        1752         647 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>plot_all_dendrograms <span class="ot">&lt;-</span> <span class="cf">function</span>(dendros, <span class="at">prefix =</span> <span class="st">"Block"</span>) {</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(dendros)) <span class="fu">stop</span>(<span class="st">"dendros is NULL"</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.list</span>(dendros)) dendros <span class="ot">&lt;-</span> <span class="fu">list</span>(dendros)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (b <span class="cf">in</span> <span class="fu">seq_along</span>(dendros)) {</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(dendros[[b]],</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="fu">paste0</span>(prefix, <span class="st">" "</span>, b, <span class="st">" clustering"</span>),</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">sub =</span> <span class="st">""</span>, <span class="at">labels =</span> <span class="cn">FALSE</span>)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_all_dendrograms</span>(tumor_net<span class="sc">$</span>geneTree,  <span class="at">prefix =</span> <span class="st">"Tumor"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Dataset2_separate_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Dataset2_separate_files/figure-html/unnamed-chunk-8-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_all_dendrograms</span>(normal_net<span class="sc">$</span>geneTree, <span class="at">prefix =</span> <span class="st">"Normal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Dataset2_separate_files/figure-html/unnamed-chunk-8-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Dataset2_separate_files/figure-html/unnamed-chunk-8-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>multiExpr_sep <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Tumor  =</span> <span class="fu">list</span>(<span class="at">data =</span> datExpr_tumor),</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Normal =</span> <span class="fu">list</span>(<span class="at">data =</span> datExpr_normal)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>multiColor_sep <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">Tumor =</span> tumor_colors, <span class="at">Normal =</span> normal_colors)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>mp_expr <span class="ot">&lt;-</span> <span class="fu">modulePreservation</span>(</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">multiData =</span> multiExpr_sep,</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">multiColor =</span> multiColor_sep,</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataIsExpr =</span> <span class="cn">TRUE</span>,</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">networkType =</span> networkType,</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">referenceNetworks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">nPermutations =</span> <span class="dv">200</span>,</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">randomSeed =</span> <span class="dv">12345</span>,</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="dv">3</span>,</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallelCalculation =</span> <span class="cn">FALSE</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ..checking data for excessive amounts of missing data..
     Flagging genes and samples with too many missing values...
      ..step 1
     Flagging genes and samples with too many missing values...
      ..step 1
  ..unassigned 'module' name: grey 
  ..all network sample 'module' name: gold
  ..calculating observed preservation values
  ..calculating permutation Z scores
 ..Working with set 1 as reference set
 ....working with set 2 as test set
  ......working on permutation 1
  ......working on permutation 2
  ......working on permutation 3
  ......working on permutation 4
  ......working on permutation 5
  ......working on permutation 6
  ......working on permutation 7
  ......working on permutation 8
  ......working on permutation 9
  ......working on permutation 10
  ......working on permutation 11
  ......working on permutation 12
  ......working on permutation 13
  ......working on permutation 14
  ......working on permutation 15
  ......working on permutation 16
  ......working on permutation 17
  ......working on permutation 18
  ......working on permutation 19
  ......working on permutation 20
  ......working on permutation 21
  ......working on permutation 22
  ......working on permutation 23
  ......working on permutation 24
  ......working on permutation 25
  ......working on permutation 26
  ......working on permutation 27
  ......working on permutation 28
  ......working on permutation 29
  ......working on permutation 30
  ......working on permutation 31
  ......working on permutation 32
  ......working on permutation 33
  ......working on permutation 34
  ......working on permutation 35
  ......working on permutation 36
  ......working on permutation 37
  ......working on permutation 38
  ......working on permutation 39
  ......working on permutation 40
  ......working on permutation 41
  ......working on permutation 42
  ......working on permutation 43
  ......working on permutation 44
  ......working on permutation 45
  ......working on permutation 46
  ......working on permutation 47
  ......working on permutation 48
  ......working on permutation 49
  ......working on permutation 50
  ......working on permutation 51
  ......working on permutation 52
  ......working on permutation 53
  ......working on permutation 54
  ......working on permutation 55
  ......working on permutation 56
  ......working on permutation 57
  ......working on permutation 58
  ......working on permutation 59
  ......working on permutation 60
  ......working on permutation 61
  ......working on permutation 62
  ......working on permutation 63
  ......working on permutation 64
  ......working on permutation 65
  ......working on permutation 66
  ......working on permutation 67
  ......working on permutation 68
  ......working on permutation 69
  ......working on permutation 70
  ......working on permutation 71
  ......working on permutation 72
  ......working on permutation 73
  ......working on permutation 74
  ......working on permutation 75
  ......working on permutation 76
  ......working on permutation 77
  ......working on permutation 78
  ......working on permutation 79
  ......working on permutation 80
  ......working on permutation 81
  ......working on permutation 82
  ......working on permutation 83
  ......working on permutation 84
  ......working on permutation 85
  ......working on permutation 86
  ......working on permutation 87
  ......working on permutation 88
  ......working on permutation 89
  ......working on permutation 90
  ......working on permutation 91
  ......working on permutation 92
  ......working on permutation 93
  ......working on permutation 94
  ......working on permutation 95
  ......working on permutation 96
  ......working on permutation 97
  ......working on permutation 98
  ......working on permutation 99
  ......working on permutation 100
  ......working on permutation 101
  ......working on permutation 102
  ......working on permutation 103
  ......working on permutation 104
  ......working on permutation 105
  ......working on permutation 106
  ......working on permutation 107
  ......working on permutation 108
  ......working on permutation 109
  ......working on permutation 110
  ......working on permutation 111
  ......working on permutation 112
  ......working on permutation 113
  ......working on permutation 114
  ......working on permutation 115
  ......working on permutation 116
  ......working on permutation 117
  ......working on permutation 118
  ......working on permutation 119
  ......working on permutation 120
  ......working on permutation 121
  ......working on permutation 122
  ......working on permutation 123
  ......working on permutation 124
  ......working on permutation 125
  ......working on permutation 126
  ......working on permutation 127
  ......working on permutation 128
  ......working on permutation 129
  ......working on permutation 130
  ......working on permutation 131
  ......working on permutation 132
  ......working on permutation 133
  ......working on permutation 134
  ......working on permutation 135
  ......working on permutation 136
  ......working on permutation 137
  ......working on permutation 138
  ......working on permutation 139
  ......working on permutation 140
  ......working on permutation 141
  ......working on permutation 142
  ......working on permutation 143
  ......working on permutation 144
  ......working on permutation 145
  ......working on permutation 146
  ......working on permutation 147
  ......working on permutation 148
  ......working on permutation 149
  ......working on permutation 150
  ......working on permutation 151
  ......working on permutation 152
  ......working on permutation 153
  ......working on permutation 154
  ......working on permutation 155
  ......working on permutation 156
  ......working on permutation 157
  ......working on permutation 158
  ......working on permutation 159
  ......working on permutation 160
  ......working on permutation 161
  ......working on permutation 162
  ......working on permutation 163
  ......working on permutation 164
  ......working on permutation 165
  ......working on permutation 166
  ......working on permutation 167
  ......working on permutation 168
  ......working on permutation 169
  ......working on permutation 170
  ......working on permutation 171
  ......working on permutation 172
  ......working on permutation 173
  ......working on permutation 174
  ......working on permutation 175
  ......working on permutation 176
  ......working on permutation 177
  ......working on permutation 178
  ......working on permutation 179
  ......working on permutation 180
  ......working on permutation 181
  ......working on permutation 182
  ......working on permutation 183
  ......working on permutation 184
  ......working on permutation 185
  ......working on permutation 186
  ......working on permutation 187
  ......working on permutation 188
  ......working on permutation 189
  ......working on permutation 190
  ......working on permutation 191
  ......working on permutation 192
  ......working on permutation 193
  ......working on permutation 194
  ......working on permutation 195
  ......working on permutation 196
  ......working on permutation 197
  ......working on permutation 198
  ......working on permutation 199
  ......working on permutation 200
 ..Working with set 2 as reference set
 ....working with set 1 as test set
  ......working on permutation 1
  ......working on permutation 2
  ......working on permutation 3
  ......working on permutation 4
  ......working on permutation 5
  ......working on permutation 6
  ......working on permutation 7
  ......working on permutation 8
  ......working on permutation 9
  ......working on permutation 10
  ......working on permutation 11
  ......working on permutation 12
  ......working on permutation 13
  ......working on permutation 14
  ......working on permutation 15
  ......working on permutation 16
  ......working on permutation 17
  ......working on permutation 18
  ......working on permutation 19
  ......working on permutation 20
  ......working on permutation 21
  ......working on permutation 22
  ......working on permutation 23
  ......working on permutation 24
  ......working on permutation 25
  ......working on permutation 26
  ......working on permutation 27
  ......working on permutation 28
  ......working on permutation 29
  ......working on permutation 30
  ......working on permutation 31
  ......working on permutation 32
  ......working on permutation 33
  ......working on permutation 34
  ......working on permutation 35
  ......working on permutation 36
  ......working on permutation 37
  ......working on permutation 38
  ......working on permutation 39
  ......working on permutation 40
  ......working on permutation 41
  ......working on permutation 42
  ......working on permutation 43
  ......working on permutation 44
  ......working on permutation 45
  ......working on permutation 46
  ......working on permutation 47
  ......working on permutation 48
  ......working on permutation 49
  ......working on permutation 50
  ......working on permutation 51
  ......working on permutation 52
  ......working on permutation 53
  ......working on permutation 54
  ......working on permutation 55
  ......working on permutation 56
  ......working on permutation 57
  ......working on permutation 58
  ......working on permutation 59
  ......working on permutation 60
  ......working on permutation 61
  ......working on permutation 62
  ......working on permutation 63
  ......working on permutation 64
  ......working on permutation 65
  ......working on permutation 66
  ......working on permutation 67
  ......working on permutation 68
  ......working on permutation 69
  ......working on permutation 70
  ......working on permutation 71
  ......working on permutation 72
  ......working on permutation 73
  ......working on permutation 74
  ......working on permutation 75
  ......working on permutation 76
  ......working on permutation 77
  ......working on permutation 78
  ......working on permutation 79
  ......working on permutation 80
  ......working on permutation 81
  ......working on permutation 82
  ......working on permutation 83
  ......working on permutation 84
  ......working on permutation 85
  ......working on permutation 86
  ......working on permutation 87
  ......working on permutation 88
  ......working on permutation 89
  ......working on permutation 90
  ......working on permutation 91
  ......working on permutation 92
  ......working on permutation 93
  ......working on permutation 94
  ......working on permutation 95
  ......working on permutation 96
  ......working on permutation 97
  ......working on permutation 98
  ......working on permutation 99
  ......working on permutation 100
  ......working on permutation 101
  ......working on permutation 102
  ......working on permutation 103
  ......working on permutation 104
  ......working on permutation 105
  ......working on permutation 106
  ......working on permutation 107
  ......working on permutation 108
  ......working on permutation 109
  ......working on permutation 110
  ......working on permutation 111
  ......working on permutation 112
  ......working on permutation 113
  ......working on permutation 114
  ......working on permutation 115
  ......working on permutation 116
  ......working on permutation 117
  ......working on permutation 118
  ......working on permutation 119
  ......working on permutation 120
  ......working on permutation 121
  ......working on permutation 122
  ......working on permutation 123
  ......working on permutation 124
  ......working on permutation 125
  ......working on permutation 126
  ......working on permutation 127
  ......working on permutation 128
  ......working on permutation 129
  ......working on permutation 130
  ......working on permutation 131
  ......working on permutation 132
  ......working on permutation 133
  ......working on permutation 134
  ......working on permutation 135
  ......working on permutation 136
  ......working on permutation 137
  ......working on permutation 138
  ......working on permutation 139
  ......working on permutation 140
  ......working on permutation 141
  ......working on permutation 142
  ......working on permutation 143
  ......working on permutation 144
  ......working on permutation 145
  ......working on permutation 146
  ......working on permutation 147
  ......working on permutation 148
  ......working on permutation 149
  ......working on permutation 150
  ......working on permutation 151
  ......working on permutation 152
  ......working on permutation 153
  ......working on permutation 154
  ......working on permutation 155
  ......working on permutation 156
  ......working on permutation 157
  ......working on permutation 158
  ......working on permutation 159
  ......working on permutation 160
  ......working on permutation 161
  ......working on permutation 162
  ......working on permutation 163
  ......working on permutation 164
  ......working on permutation 165
  ......working on permutation 166
  ......working on permutation 167
  ......working on permutation 168
  ......working on permutation 169
  ......working on permutation 170
  ......working on permutation 171
  ......working on permutation 172
  ......working on permutation 173
  ......working on permutation 174
  ......working on permutation 175
  ......working on permutation 176
  ......working on permutation 177
  ......working on permutation 178
  ......working on permutation 179
  ......working on permutation 180
  ......working on permutation 181
  ......working on permutation 182
  ......working on permutation 183
  ......working on permutation 184
  ......working on permutation 185
  ......working on permutation 186
  ......working on permutation 187
  ......working on permutation 188
  ......working on permutation 189
  ......working on permutation 190
  ......working on permutation 191
  ......working on permutation 192
  ......working on permutation 193
  ......working on permutation 194
  ......working on permutation 195
  ......working on permutation 196
  ......working on permutation 197
  ......working on permutation 198
  ......working on permutation 199
  ......working on permutation 200</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(mp_expr, <span class="at">file =</span> <span class="st">"GSE62043_modulePreservation_separate.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preservation summary</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>extract_preservation <span class="ot">&lt;-</span> <span class="cf">function</span>(mp_obj, <span class="at">ref =</span> <span class="fu">c</span>(<span class="st">"Tumor"</span>,<span class="st">"Normal"</span>), <span class="at">test =</span> <span class="fu">c</span>(<span class="st">"Tumor"</span>,<span class="st">"Normal"</span>)) {</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  ref  <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(ref); test <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(test)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  ref_key  <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"ref."</span>, ref)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  test_key <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"inColumnsAlsoPresentIn."</span>, test)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  zlist <span class="ot">&lt;-</span> mp_obj<span class="sc">$</span>preservation<span class="sc">$</span>Z</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  statsZ <span class="ot">&lt;-</span> zlist[[ref_key]][[test_key]]</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(statsZ)) <span class="fu">stop</span>(<span class="st">"No Z for "</span>, ref_key, <span class="st">" vs "</span>, test_key)</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"gold"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(statsZ)) statsZ <span class="ot">&lt;-</span> statsZ[<span class="fu">rownames</span>(statsZ) <span class="sc">!=</span> <span class="st">"gold"</span>, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>  zsum_col <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">c</span>(<span class="st">"Zsummary.pres"</span>, <span class="st">"Zsummary"</span>), <span class="fu">colnames</span>(statsZ))[<span class="dv">1</span>]</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(zsum_col)) <span class="fu">stop</span>(<span class="st">"No Zsummary column in "</span>, <span class="fu">paste</span>(<span class="fu">colnames</span>(statsZ), <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>  Zsummary_pres <span class="ot">&lt;-</span> statsZ[, zsum_col]</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>  obslist <span class="ot">&lt;-</span> mp_obj<span class="sc">$</span>preservation<span class="sc">$</span>observed</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>  medianRank_pres <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(obslist)) {</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>    statsO <span class="ot">&lt;-</span> obslist[[ref_key]][[test_key]]</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(statsO) <span class="sc">&amp;&amp;</span> <span class="st">"gold"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(statsO)) statsO <span class="ot">&lt;-</span> statsO[<span class="fu">rownames</span>(statsO) <span class="sc">!=</span> <span class="st">"gold"</span>, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(statsO)) {</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>      mcol <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">c</span>(<span class="st">"medianRank.pres"</span>, <span class="st">"medianRank"</span>), <span class="fu">colnames</span>(statsO))[<span class="dv">1</span>]</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(mcol)) medianRank_pres <span class="ot">&lt;-</span> statsO[<span class="fu">rownames</span>(statsZ), mcol]</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(medianRank_pres)) medianRank_pres <span class="ot">&lt;-</span> <span class="fu">rank</span>(<span class="sc">-</span>Zsummary_pres, <span class="at">ties.method =</span> <span class="st">"average"</span>)</span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">module =</span> <span class="fu">rownames</span>(statsZ),</span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">Zsummary_pres =</span> <span class="fu">as.numeric</span>(Zsummary_pres),</span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">medianRank_pres =</span> <span class="fu">as.numeric</span>(medianRank_pres),</span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.names =</span> <span class="cn">NULL</span></span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a>  out[<span class="fu">order</span>(<span class="sc">-</span>out<span class="sc">$</span>Zsummary_pres), ]</span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a>tumor_in_normal <span class="ot">&lt;-</span> <span class="fu">extract_preservation</span>(mp_expr, <span class="at">ref =</span> <span class="st">"Tumor"</span>,  <span class="at">test =</span> <span class="st">"Normal"</span>)</span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a>normal_in_tumor <span class="ot">&lt;-</span> <span class="fu">extract_preservation</span>(mp_expr, <span class="at">ref =</span> <span class="st">"Normal"</span>, <span class="at">test =</span> <span class="st">"Tumor"</span>)</span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tumor_in_normal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          module Zsummary_pres medianRank_pres
24        yellow     81.197412               3
23     turquoise     58.923198               6
17          pink     52.910273               5
22           tan     47.740714               3
2           blue     42.392893              11
1          black     41.907329               8
18        purple     41.846554               6
3          brown     41.511854              12
13    lightgreen     34.503696               2
20     royalblue     29.957302               4
9    greenyellow     26.504582              13
8          green     22.400935              18
19           red     17.654945              23
10          grey     17.352697              24
21        salmon     15.821738              16
4           cyan     15.060232              13
5      darkgreen     14.398399               9
7  darkturquoise     13.833988              10
12     lightcyan     12.115693              17
15       magenta     10.683427              24
16  midnightblue      7.810579              17
11        grey60      7.556173              21
14   lightyellow      6.830754              21
6        darkred      5.802020              22</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(normal_in_tumor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        module Zsummary_pres medianRank_pres
12      yellow     103.01095               5
2         blue      82.02836               6
7      magenta      78.01269               2
5  greenyellow      77.79226               1
11   turquoise      53.65845               8
8         pink      53.43642               4
10         red      46.44369               7
9       purple      42.17187               3
3        brown      40.40667              11
4        green      32.58544               9
1        black      23.36790              10
6         grey      12.69064              13</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tumor_in_normal<span class="sc">$</span>Zsummary_pres,</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xaxt =</span> <span class="st">"n"</span>, <span class="at">pch =</span> <span class="dv">19</span>,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Tumor modules"</span>,</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Zsummary"</span>,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Tumor→Normal preservation"</span>)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="fu">seq_along</span>(tumor_in_normal<span class="sc">$</span>module),</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">labels =</span> tumor_in_normal<span class="sc">$</span>module, <span class="at">las =</span> <span class="dv">2</span>, <span class="at">cex.axis =</span> <span class="fl">0.7</span>)</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">2</span>,  <span class="at">col =</span> <span class="st">"red"</span>,  <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">10</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Dataset2_separate_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(consensus_net, consensus_colors,</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>     ME_cons_tumor, ME_cons_normal, ME_cons_all, cons_lmm_df,</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>     tumor_net, normal_net, tumor_colors, normal_colors,</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>     tumor_in_normal, normal_in_tumor,</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">file =</span> <span class="st">"GSE62043_WGCNA_results.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare to paired export</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(WGCNA)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(nlme)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(dplyr)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(pheatmap)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(mclust)</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Paket 'mclust' wurde unter R Version 4.5.2 erstellt</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">%||%</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b) <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(a)) a <span class="cf">else</span> b</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>dataset_id <span class="ot">&lt;-</span> <span class="st">"GSE62043"</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>paired_file <span class="ot">&lt;-</span> <span class="st">"paired_wgcna_export_GSE62043_20260102.rds"</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>paired <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(paired_file)</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Loaded paired export: "</span>, paired_file)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded paired export: paired_wgcna_export_GSE62043_20260102.rds</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>moduleColors_wgcna <span class="ot">&lt;-</span> paired<span class="sc">$</span>moduleColors</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>lmm_wgcna          <span class="ot">&lt;-</span> paired<span class="sc">$</span>lmm_results</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>softPower_wgcna    <span class="ot">&lt;-</span> paired<span class="sc">$</span>softPower <span class="sc">%||%</span> paired<span class="sc">$</span>softpower</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>networkType_wgcna  <span class="ot">&lt;-</span> paired<span class="sc">$</span>networkType <span class="sc">%||%</span> <span class="st">"unsigned"</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">names</span>(moduleColors_wgcna)))</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(softPower_wgcna) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(softPower_wgcna) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>moduleColors_tumor  <span class="ot">&lt;-</span> tumor_colors</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>moduleColors_normal <span class="ot">&lt;-</span> normal_colors</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>genes_common <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(intersect, <span class="fu">list</span>(</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(moduleColors_wgcna),</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(moduleColors_tumor),</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(moduleColors_normal)</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(genes_common) <span class="sc">&lt;</span> <span class="dv">100</span>) <span class="fu">stop</span>(<span class="st">"Too few common genes: "</span>, <span class="fu">length</span>(genes_common))</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Common genes: "</span>, <span class="fu">length</span>(genes_common))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Common genes: 19595</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>compare_module_overlap <span class="ot">&lt;-</span> <span class="cf">function</span>(colors_A, colors_B,</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">name_A =</span> <span class="st">"A"</span>, <span class="at">name_B =</span> <span class="st">"B"</span>,</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">dropGrey =</span> <span class="cn">TRUE</span>,</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">minSize =</span> <span class="dv">10</span>,</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">cluster_rows =</span> <span class="cn">TRUE</span>, <span class="at">cluster_cols =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  common <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(colors_A), <span class="fu">names</span>(colors_B))</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  ca <span class="ot">&lt;-</span> colors_A[common]</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  cb <span class="ot">&lt;-</span> colors_B[common]</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (dropGrey) {</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>    keep <span class="ot">&lt;-</span> <span class="sc">!</span>(ca <span class="sc">%in%</span> <span class="st">"grey"</span> <span class="sc">|</span> cb <span class="sc">%in%</span> <span class="st">"grey"</span>)</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>    ca <span class="ot">&lt;-</span> ca[keep]; cb <span class="ot">&lt;-</span> cb[keep]</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>  tab <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">A =</span> ca, <span class="at">B =</span> cb)</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>  tab <span class="ot">&lt;-</span> tab[<span class="fu">rowSums</span>(tab) <span class="sc">&gt;=</span> minSize, <span class="fu">colSums</span>(tab) <span class="sc">&gt;=</span> minSize, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(tab) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">rownames</span>(tab), <span class="st">" (n="</span>, <span class="fu">rowSums</span>(tab), <span class="st">")"</span>)</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(tab) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">colnames</span>(tab), <span class="st">" (n="</span>, <span class="fu">colSums</span>(tab), <span class="st">")"</span>)</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>  pheatmap<span class="sc">::</span><span class="fu">pheatmap</span>(</span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>    tab,</span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">cluster_rows =</span> cluster_rows,</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">cluster_cols =</span> cluster_cols,</span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">"Overlap: "</span>, name_A, <span class="st">" vs "</span>, name_B)</span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>  ari <span class="ot">&lt;-</span> mclust<span class="sc">::</span><span class="fu">adjustedRandIndex</span>(<span class="fu">as.integer</span>(<span class="fu">factor</span>(ca)), <span class="fu">as.integer</span>(<span class="fu">factor</span>(cb)))</span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">ARI("</span>, name_A, <span class="st">" vs "</span>, name_B, <span class="st">")="</span>, <span class="fu">signif</span>(ari, <span class="dv">4</span>),</span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a>      <span class="st">" [n="</span>, <span class="fu">length</span>(ca), <span class="st">"]</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(<span class="fu">list</span>(<span class="at">tab =</span> tab, <span class="at">ari =</span> ari, <span class="at">n =</span> <span class="fu">length</span>(ca)))</span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a>ov_w_t <span class="ot">&lt;-</span> <span class="fu">compare_module_overlap</span>(moduleColors_wgcna, moduleColors_tumor,  <span class="st">"Paired"</span>, <span class="st">"Tumor"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Dataset2_separate_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
ARI(Paired vs Tumor)=0.4636 [n=9489]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>ov_w_n <span class="ot">&lt;-</span> <span class="fu">compare_module_overlap</span>(moduleColors_wgcna, moduleColors_normal, <span class="st">"Paired"</span>, <span class="st">"Normal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Dataset2_separate_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
ARI(Paired vs Normal)=0.5438 [n=6070]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>ov_t_n <span class="ot">&lt;-</span> <span class="fu">compare_module_overlap</span>(moduleColors_tumor,  moduleColors_normal, <span class="st">"Tumor"</span>,  <span class="st">"Normal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Dataset2_separate_files/figure-html/unnamed-chunk-10-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
ARI(Tumor vs Normal)=0.479 [n=6694]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>enforce_pairing <span class="ot">&lt;-</span> <span class="cf">function</span>(d, <span class="at">id =</span> <span class="st">"patient_id"</span>, <span class="at">cond =</span> <span class="st">"tumour"</span>) {</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  tab <span class="ot">&lt;-</span> <span class="fu">table</span>(d[[id]], d[[cond]])</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  keep_ids <span class="ot">&lt;-</span> <span class="fu">rownames</span>(tab)[<span class="fu">rowSums</span>(tab <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">==</span> <span class="dv">2</span>]</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  d[d[[id]] <span class="sc">%in%</span> keep_ids, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>fit_module_lmm <span class="ot">&lt;-</span> <span class="cf">function</span>(MEs_mat, traits,</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">covars =</span> <span class="fu">c</span>(<span class="st">"Age"</span>, <span class="st">"Gender"</span>),</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>                           <span class="at">tumour_var =</span> <span class="st">"tumour"</span>,</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>                           <span class="at">id_var =</span> <span class="st">"patient_id"</span>) {</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">identical</span>(<span class="fu">rownames</span>(MEs_mat), <span class="fu">rownames</span>(traits)))</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>  covars <span class="ot">&lt;-</span> covars[covars <span class="sc">%in%</span> <span class="fu">colnames</span>(traits)]</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>  covars <span class="ot">&lt;-</span> covars[<span class="sc">!</span><span class="fu">sapply</span>(traits[covars], <span class="cf">function</span>(v) <span class="fu">all</span>(<span class="fu">is.na</span>(v)))]</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>  rhs <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">c</span>(tumour_var, covars), <span class="at">collapse =</span> <span class="st">" + "</span>)</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(traits[, <span class="fu">c</span>(id_var, tumour_var, covars), <span class="at">drop =</span> <span class="cn">FALSE</span>],</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>               <span class="fu">as.data.frame</span>(MEs_mat))</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">colnames</span>(MEs_mat), <span class="cf">function</span>(mn) {</span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>    cols_needed <span class="ot">&lt;-</span> <span class="fu">c</span>(id_var, tumour_var, covars, mn)</span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> dat[, cols_needed, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> d[<span class="fu">complete.cases</span>(d), , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> <span class="fu">enforce_pairing</span>(d, <span class="at">id =</span> id_var, <span class="at">cond =</span> tumour_var)</span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(d) <span class="sc">&lt;</span> <span class="dv">4</span>) <span class="fu">return</span>(<span class="fu">data.frame</span>(<span class="at">module =</span> mn, <span class="at">beta_tumour =</span> <span class="cn">NA</span>, <span class="at">t_tumour =</span> <span class="cn">NA</span>, <span class="at">p_tumour =</span> <span class="cn">NA</span>))</span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a>    fit <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(</span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a>      nlme<span class="sc">::</span><span class="fu">lme</span>(<span class="fu">as.formula</span>(<span class="fu">paste</span>(mn, <span class="st">"~"</span>, rhs)),</span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a>                <span class="at">random =</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~1|"</span>, id_var)),</span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> d, <span class="at">method =</span> <span class="st">"REML"</span>, <span class="at">control =</span> ctrl_lme),</span>
<span id="cb72-32"><a href="#cb72-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NULL</span></span>
<span id="cb72-33"><a href="#cb72-33" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb72-34"><a href="#cb72-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(fit)) <span class="fu">return</span>(<span class="fu">data.frame</span>(<span class="at">module =</span> mn, <span class="at">beta_tumour =</span> <span class="cn">NA</span>, <span class="at">t_tumour =</span> <span class="cn">NA</span>, <span class="at">p_tumour =</span> <span class="cn">NA</span>))</span>
<span id="cb72-35"><a href="#cb72-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-36"><a href="#cb72-36" aria-hidden="true" tabindex="-1"></a>    sm <span class="ot">&lt;-</span> <span class="fu">summary</span>(fit)</span>
<span id="cb72-37"><a href="#cb72-37" aria-hidden="true" tabindex="-1"></a>    coef_name <span class="ot">&lt;-</span> <span class="cf">if</span> (tumour_var <span class="sc">%in%</span> <span class="fu">rownames</span>(sm<span class="sc">$</span>tTable)) tumour_var <span class="cf">else</span></span>
<span id="cb72-38"><a href="#cb72-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grep</span>(<span class="fu">paste0</span>(<span class="st">"^"</span>, tumour_var), <span class="fu">rownames</span>(sm<span class="sc">$</span>tTable), <span class="at">value =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span>]</span>
<span id="cb72-39"><a href="#cb72-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-40"><a href="#cb72-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb72-41"><a href="#cb72-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">module =</span> mn,</span>
<span id="cb72-42"><a href="#cb72-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">beta_tumour =</span> sm<span class="sc">$</span>tTable[coef_name, <span class="st">"Value"</span>],</span>
<span id="cb72-43"><a href="#cb72-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">t_tumour    =</span> sm<span class="sc">$</span>tTable[coef_name, <span class="st">"t-value"</span>],</span>
<span id="cb72-44"><a href="#cb72-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">p_tumour    =</span> sm<span class="sc">$</span>tTable[coef_name, <span class="st">"p-value"</span>]</span>
<span id="cb72-45"><a href="#cb72-45" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb72-46"><a href="#cb72-46" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb72-47"><a href="#cb72-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-48"><a href="#cb72-48" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(res)</span>
<span id="cb72-49"><a href="#cb72-49" aria-hidden="true" tabindex="-1"></a>  out<span class="sc">$</span>FDR_tumour <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(out<span class="sc">$</span>p_tumour, <span class="at">method =</span> <span class="st">"BH"</span>)</span>
<span id="cb72-50"><a href="#cb72-50" aria-hidden="true" tabindex="-1"></a>  out[<span class="fu">order</span>(out<span class="sc">$</span>p_tumour), ]</span>
<span id="cb72-51"><a href="#cb72-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb72-52"><a href="#cb72-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-53"><a href="#cb72-53" aria-hidden="true" tabindex="-1"></a>ME_tumor_all  <span class="ot">&lt;-</span> <span class="fu">orderMEs</span>(<span class="fu">moduleEigengenes</span>(datExpr, <span class="at">colors =</span> moduleColors_tumor)<span class="sc">$</span>eigengenes)</span>
<span id="cb72-54"><a href="#cb72-54" aria-hidden="true" tabindex="-1"></a>ME_normal_all <span class="ot">&lt;-</span> <span class="fu">orderMEs</span>(<span class="fu">moduleEigengenes</span>(datExpr, <span class="at">colors =</span> moduleColors_normal)<span class="sc">$</span>eigengenes)</span>
<span id="cb72-55"><a href="#cb72-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-56"><a href="#cb72-56" aria-hidden="true" tabindex="-1"></a>lmm_tumor  <span class="ot">&lt;-</span> <span class="fu">fit_module_lmm</span>(ME_tumor_all,  sampleTraits)</span>
<span id="cb72-57"><a href="#cb72-57" aria-hidden="true" tabindex="-1"></a>lmm_normal <span class="ot">&lt;-</span> <span class="fu">fit_module_lmm</span>(ME_normal_all, sampleTraits)</span>
<span id="cb72-58"><a href="#cb72-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-59"><a href="#cb72-59" aria-hidden="true" tabindex="-1"></a>get_top_color <span class="ot">&lt;-</span> <span class="cf">function</span>(lmm_df) <span class="fu">sub</span>(<span class="st">"^ME"</span>, <span class="st">""</span>, lmm_df<span class="sc">$</span>module[<span class="fu">order</span>(lmm_df<span class="sc">$</span>p_tumour)][<span class="dv">1</span>])</span>
<span id="cb72-60"><a href="#cb72-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-61"><a href="#cb72-61" aria-hidden="true" tabindex="-1"></a>top_wgcna_color  <span class="ot">&lt;-</span> <span class="fu">get_top_color</span>(lmm_wgcna)</span>
<span id="cb72-62"><a href="#cb72-62" aria-hidden="true" tabindex="-1"></a>top_tumor_color  <span class="ot">&lt;-</span> <span class="fu">get_top_color</span>(lmm_tumor)</span>
<span id="cb72-63"><a href="#cb72-63" aria-hidden="true" tabindex="-1"></a>top_normal_color <span class="ot">&lt;-</span> <span class="fu">get_top_color</span>(lmm_normal)</span>
<span id="cb72-64"><a href="#cb72-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-65"><a href="#cb72-65" aria-hidden="true" tabindex="-1"></a>jaccard <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b) <span class="fu">length</span>(<span class="fu">intersect</span>(a, b)) <span class="sc">/</span> <span class="fu">length</span>(<span class="fu">union</span>(a, b))</span>
<span id="cb72-66"><a href="#cb72-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-67"><a href="#cb72-67" aria-hidden="true" tabindex="-1"></a>genes_w <span class="ot">&lt;-</span> <span class="fu">names</span>(moduleColors_wgcna)[moduleColors_wgcna <span class="sc">==</span> top_wgcna_color]</span>
<span id="cb72-68"><a href="#cb72-68" aria-hidden="true" tabindex="-1"></a>genes_t <span class="ot">&lt;-</span> <span class="fu">names</span>(moduleColors_tumor)[moduleColors_tumor <span class="sc">==</span> top_tumor_color]</span>
<span id="cb72-69"><a href="#cb72-69" aria-hidden="true" tabindex="-1"></a>genes_n <span class="ot">&lt;-</span> <span class="fu">names</span>(moduleColors_normal)[moduleColors_normal <span class="sc">==</span> top_normal_color]</span>
<span id="cb72-70"><a href="#cb72-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-71"><a href="#cb72-71" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Top modules:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top modules:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Paired: "</span>, top_wgcna_color, <span class="st">" ("</span>, <span class="fu">length</span>(genes_w), <span class="st">")</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep=</span><span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Paired: green (1029)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Tumor : "</span>, top_tumor_color, <span class="st">" ("</span>, <span class="fu">length</span>(genes_t), <span class="st">")</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep=</span><span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Tumor : grey (5237)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Normal: "</span>, top_normal_color, <span class="st">" ("</span>, <span class="fu">length</span>(genes_n), <span class="st">")</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep=</span><span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Normal: grey (12304)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Jaccard:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Jaccard:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Paired vs Tumor : "</span>, <span class="fu">signif</span>(<span class="fu">jaccard</span>(genes_w, genes_t), <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep=</span><span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Paired vs Tumor : 0.01342</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Paired vs Normal: "</span>, <span class="fu">signif</span>(<span class="fu">jaccard</span>(genes_w, genes_n), <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep=</span><span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Paired vs Normal: 0.06003</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>compute_TOM_subset <span class="ot">&lt;-</span> <span class="cf">function</span>(datExpr_mat, power, <span class="at">networkType =</span> <span class="st">"unsigned"</span>) {</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  A <span class="ot">&lt;-</span> <span class="fu">adjacency</span>(datExpr_mat, <span class="at">power =</span> power, <span class="at">type =</span> networkType)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  TOM <span class="ot">&lt;-</span> <span class="fu">TOMsimilarity</span>(A, <span class="at">TOMType =</span> networkType)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dimnames</span>(TOM) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">colnames</span>(datExpr_mat), <span class="fu">colnames</span>(datExpr_mat))</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>  TOM</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>pick_top_var_genes <span class="ot">&lt;-</span> <span class="cf">function</span>(datExpr_mat, <span class="at">n =</span> <span class="dv">3000</span>) {</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>  v <span class="ot">&lt;-</span> <span class="fu">apply</span>(datExpr_mat, <span class="dv">2</span>, var, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(<span class="fu">sort</span>(v, <span class="at">decreasing =</span> <span class="cn">TRUE</span>))[<span class="fu">seq_len</span>(<span class="fu">min</span>(n, <span class="fu">length</span>(v)))]</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>build_three_TOMs <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">gene_counts =</span> <span class="fu">c</span>(<span class="dv">4000</span>, <span class="dv">3000</span>, <span class="dv">2000</span>, <span class="dv">1500</span>, <span class="dv">1000</span>)) {</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (ng <span class="cf">in</span> gene_counts) {</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"TOM subset: "</span>, ng)</span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>    genes_sub <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">pick_top_var_genes</span>(datExpr, <span class="at">n =</span> ng), genes_common)</span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(genes_sub) <span class="sc">&lt;</span> <span class="dv">500</span>) <span class="cf">next</span></span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>      TOM_w <span class="ot">&lt;-</span> <span class="fu">compute_TOM_subset</span>(datExpr[, genes_sub, <span class="at">drop =</span> <span class="cn">FALSE</span>],      <span class="at">power =</span> softPower_wgcna,  <span class="at">networkType =</span> networkType_wgcna); <span class="fu">gc</span>()</span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>      TOM_t <span class="ot">&lt;-</span> <span class="fu">compute_TOM_subset</span>(datExpr_tumor[, genes_sub, <span class="at">drop =</span> <span class="cn">FALSE</span>], <span class="at">power =</span> softPower_tumor,  <span class="at">networkType =</span> networkType); <span class="fu">gc</span>()</span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>      TOM_n <span class="ot">&lt;-</span> <span class="fu">compute_TOM_subset</span>(datExpr_normal[, genes_sub, <span class="at">drop =</span> <span class="cn">FALSE</span>],<span class="at">power =</span> softPower_normal, <span class="at">networkType =</span> networkType); <span class="fu">gc</span>()</span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="at">genes =</span> genes_sub, <span class="at">TOM_w =</span> TOM_w, <span class="at">TOM_t =</span> TOM_t, <span class="at">TOM_n =</span> TOM_n)</span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>    }, <span class="at">error =</span> <span class="cf">function</span>(e) { <span class="fu">message</span>(<span class="st">"fail: "</span>, e<span class="sc">$</span>message); <span class="cn">NULL</span> })</span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(out)) <span class="fu">return</span>(out)</span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"TOM failed for all sizes."</span>)</span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a>compare_edge_weights <span class="ot">&lt;-</span> <span class="cf">function</span>(TOM_A, TOM_B, <span class="at">name_A =</span> <span class="st">"A"</span>, <span class="at">name_B =</span> <span class="st">"B"</span>) {</span>
<span id="cb86-32"><a href="#cb86-32" aria-hidden="true" tabindex="-1"></a>  common <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">rownames</span>(TOM_A), <span class="fu">rownames</span>(TOM_B))</span>
<span id="cb86-33"><a href="#cb86-33" aria-hidden="true" tabindex="-1"></a>  A <span class="ot">&lt;-</span> TOM_A[common, common]</span>
<span id="cb86-34"><a href="#cb86-34" aria-hidden="true" tabindex="-1"></a>  B <span class="ot">&lt;-</span> TOM_B[common, common]</span>
<span id="cb86-35"><a href="#cb86-35" aria-hidden="true" tabindex="-1"></a>  v1 <span class="ot">&lt;-</span> A[<span class="fu">upper.tri</span>(A)]</span>
<span id="cb86-36"><a href="#cb86-36" aria-hidden="true" tabindex="-1"></a>  v2 <span class="ot">&lt;-</span> B[<span class="fu">upper.tri</span>(B)]</span>
<span id="cb86-37"><a href="#cb86-37" aria-hidden="true" tabindex="-1"></a>  test <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(v1, v2, <span class="at">method =</span> <span class="st">"spearman"</span>)</span>
<span id="cb86-38"><a href="#cb86-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(test)</span>
<span id="cb86-39"><a href="#cb86-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(v1, v2, <span class="at">pch =</span> <span class="dv">20</span>,</span>
<span id="cb86-40"><a href="#cb86-40" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="fu">paste0</span>(name_A, <span class="st">" TOM"</span>),</span>
<span id="cb86-41"><a href="#cb86-41" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylab =</span> <span class="fu">paste0</span>(name_B, <span class="st">" TOM"</span>),</span>
<span id="cb86-42"><a href="#cb86-42" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">"Edges: "</span>, name_A, <span class="st">" vs "</span>, name_B))</span>
<span id="cb86-43"><a href="#cb86-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(test)</span>
<span id="cb86-44"><a href="#cb86-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb86-45"><a href="#cb86-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-46"><a href="#cb86-46" aria-hidden="true" tabindex="-1"></a>compare_hubs <span class="ot">&lt;-</span> <span class="cf">function</span>(TOM_A, TOM_B, <span class="at">name_A =</span> <span class="st">"A"</span>, <span class="at">name_B =</span> <span class="st">"B"</span>, <span class="at">topK =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">100</span>)) {</span>
<span id="cb86-47"><a href="#cb86-47" aria-hidden="true" tabindex="-1"></a>  common <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">rownames</span>(TOM_A), <span class="fu">rownames</span>(TOM_B))</span>
<span id="cb86-48"><a href="#cb86-48" aria-hidden="true" tabindex="-1"></a>  A <span class="ot">&lt;-</span> TOM_A[common, common]</span>
<span id="cb86-49"><a href="#cb86-49" aria-hidden="true" tabindex="-1"></a>  B <span class="ot">&lt;-</span> TOM_B[common, common]</span>
<span id="cb86-50"><a href="#cb86-50" aria-hidden="true" tabindex="-1"></a>  kA <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(A) <span class="sc">-</span> <span class="fu">diag</span>(A)</span>
<span id="cb86-51"><a href="#cb86-51" aria-hidden="true" tabindex="-1"></a>  kB <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(B) <span class="sc">-</span> <span class="fu">diag</span>(B)</span>
<span id="cb86-52"><a href="#cb86-52" aria-hidden="true" tabindex="-1"></a>  test <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(kA, kB, <span class="at">method =</span> <span class="st">"spearman"</span>)</span>
<span id="cb86-53"><a href="#cb86-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(test)</span>
<span id="cb86-54"><a href="#cb86-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Hub overlap ("</span>, name_A, <span class="st">" vs "</span>, name_B, <span class="st">")</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep=</span><span class="st">""</span>)</span>
<span id="cb86-55"><a href="#cb86-55" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (K <span class="cf">in</span> topK) {</span>
<span id="cb86-56"><a href="#cb86-56" aria-hidden="true" tabindex="-1"></a>    hubsA <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">sort</span>(kA, <span class="at">decreasing =</span> <span class="cn">TRUE</span>))[<span class="dv">1</span><span class="sc">:</span>K]</span>
<span id="cb86-57"><a href="#cb86-57" aria-hidden="true" tabindex="-1"></a>    hubsB <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">sort</span>(kB, <span class="at">decreasing =</span> <span class="cn">TRUE</span>))[<span class="dv">1</span><span class="sc">:</span>K]</span>
<span id="cb86-58"><a href="#cb86-58" aria-hidden="true" tabindex="-1"></a>    ol <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">intersect</span>(hubsA, hubsB))</span>
<span id="cb86-59"><a href="#cb86-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"K="</span>, K, <span class="st">" overlap="</span>, ol, <span class="st">" ("</span>, <span class="fu">round</span>(<span class="dv">100</span><span class="sc">*</span>ol<span class="sc">/</span>K, <span class="dv">1</span>), <span class="st">"%)</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">sep=</span><span class="st">""</span>)</span>
<span id="cb86-60"><a href="#cb86-60" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb86-61"><a href="#cb86-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(kA, kB, <span class="at">pch =</span> <span class="dv">20</span>,</span>
<span id="cb86-62"><a href="#cb86-62" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="fu">paste0</span>(name_A, <span class="st">" strength"</span>),</span>
<span id="cb86-63"><a href="#cb86-63" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylab =</span> <span class="fu">paste0</span>(name_B, <span class="st">" strength"</span>),</span>
<span id="cb86-64"><a href="#cb86-64" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">"Hubs: "</span>, name_A, <span class="st">" vs "</span>, name_B))</span>
<span id="cb86-65"><a href="#cb86-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="fu">lm</span>(kB <span class="sc">~</span> kA), <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb86-66"><a href="#cb86-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(<span class="fu">list</span>(<span class="at">test =</span> test, <span class="at">kA =</span> kA, <span class="at">kB =</span> kB))</span>
<span id="cb86-67"><a href="#cb86-67" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb86-68"><a href="#cb86-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-69"><a href="#cb86-69" aria-hidden="true" tabindex="-1"></a>tom_pack <span class="ot">&lt;-</span> <span class="fu">build_three_TOMs</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>TOM subset: 4000</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>..connectivity..
..matrix multiplication (system BLAS)..
..normalization..
..done.
..connectivity..
..matrix multiplication (system BLAS)..
..normalization..
..done.
..connectivity..
..matrix multiplication (system BLAS)..
..normalization..
..done.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>ew_w_t <span class="ot">&lt;-</span> <span class="fu">compare_edge_weights</span>(tom_pack<span class="sc">$</span>TOM_w, tom_pack<span class="sc">$</span>TOM_t, <span class="st">"Paired"</span>, <span class="st">"Tumor"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Spearman's rank correlation rho

data:  v1 and v2
S = 3.6545e+19, p-value &lt; 2.2e-16
alternative hypothesis: true rho is not equal to 0
sample estimates:
      rho 
0.5714157 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Dataset2_separate_files/figure-html/unnamed-chunk-10-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>ew_w_n <span class="ot">&lt;-</span> <span class="fu">compare_edge_weights</span>(tom_pack<span class="sc">$</span>TOM_w, tom_pack<span class="sc">$</span>TOM_n, <span class="st">"Paired"</span>, <span class="st">"Normal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Spearman's rank correlation rho

data:  v1 and v2
S = 5.2024e+19, p-value &lt; 2.2e-16
alternative hypothesis: true rho is not equal to 0
sample estimates:
      rho 
0.3898875 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Dataset2_separate_files/figure-html/unnamed-chunk-10-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>ew_t_n <span class="ot">&lt;-</span> <span class="fu">compare_edge_weights</span>(tom_pack<span class="sc">$</span>TOM_t, tom_pack<span class="sc">$</span>TOM_n, <span class="st">"Tumor"</span>,  <span class="st">"Normal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Spearman's rank correlation rho

data:  v1 and v2
S = 4.8755e+19, p-value &lt; 2.2e-16
alternative hypothesis: true rho is not equal to 0
sample estimates:
      rho 
0.4282186 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Dataset2_separate_files/figure-html/unnamed-chunk-10-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>hb_w_t <span class="ot">&lt;-</span> <span class="fu">compare_hubs</span>(tom_pack<span class="sc">$</span>TOM_w, tom_pack<span class="sc">$</span>TOM_t, <span class="st">"Paired"</span>, <span class="st">"Tumor"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Spearman's rank correlation rho

data:  kA and kB
S = 3473918006, p-value &lt; 2.2e-16
alternative hypothesis: true rho is not equal to 0
sample estimates:
      rho 
0.6743202 


Hub overlap (Paired vs Tumor)
K=25 overlap=2 (8%)
K=50 overlap=9 (18%)
K=75 overlap=15 (20%)
K=100 overlap=20 (20%)</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Dataset2_separate_files/figure-html/unnamed-chunk-10-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>hb_w_n <span class="ot">&lt;-</span> <span class="fu">compare_hubs</span>(tom_pack<span class="sc">$</span>TOM_w, tom_pack<span class="sc">$</span>TOM_n, <span class="st">"Paired"</span>, <span class="st">"Normal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Spearman's rank correlation rho

data:  kA and kB
S = 5.815e+09, p-value &lt; 2.2e-16
alternative hypothesis: true rho is not equal to 0
sample estimates:
      rho 
0.4548472 


Hub overlap (Paired vs Normal)
K=25 overlap=0 (0%)
K=50 overlap=0 (0%)
K=75 overlap=2 (2.7%)
K=100 overlap=3 (3%)</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Dataset2_separate_files/figure-html/unnamed-chunk-10-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>hb_t_n <span class="ot">&lt;-</span> <span class="fu">compare_hubs</span>(tom_pack<span class="sc">$</span>TOM_t, tom_pack<span class="sc">$</span>TOM_n, <span class="st">"Tumor"</span>,  <span class="st">"Normal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Spearman's rank correlation rho

data:  kA and kB
S = 4483098944, p-value &lt; 2.2e-16
alternative hypothesis: true rho is not equal to 0
sample estimates:
      rho 
0.5797094 


Hub overlap (Tumor vs Normal)
K=25 overlap=0 (0%)
K=50 overlap=0 (0%)
K=75 overlap=4 (5.3%)
K=100 overlap=10 (10%)</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Dataset2_separate_files/figure-html/unnamed-chunk-10-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>comparison_out <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset_id =</span> dataset_id,</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">paired_file =</span> paired_file,</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">genes_common =</span> genes_common,</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">overlap =</span> <span class="fu">list</span>(<span class="at">paired_vs_tumor =</span> ov_w_t, <span class="at">paired_vs_normal =</span> ov_w_n, <span class="at">tumor_vs_normal =</span> ov_t_n),</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">lmm =</span> <span class="fu">list</span>(<span class="at">paired =</span> lmm_wgcna, <span class="at">tumor =</span> lmm_tumor, <span class="at">normal =</span> lmm_normal),</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">top_modules =</span> <span class="fu">list</span>(<span class="at">paired =</span> top_wgcna_color, <span class="at">tumor =</span> top_tumor_color, <span class="at">normal =</span> top_normal_color),</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">jaccard =</span> <span class="fu">c</span>(<span class="at">paired_vs_tumor =</span> <span class="fu">jaccard</span>(genes_w, genes_t), <span class="at">paired_vs_normal =</span> <span class="fu">jaccard</span>(genes_w, genes_n)),</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">tom_subset =</span> <span class="fu">list</span>(<span class="at">genes =</span> tom_pack<span class="sc">$</span>genes),</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">edge_tests =</span> <span class="fu">list</span>(<span class="at">paired_vs_tumor =</span> ew_w_t, <span class="at">paired_vs_normal =</span> ew_w_n, <span class="at">tumor_vs_normal =</span> ew_t_n),</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">hub_tests  =</span> <span class="fu">list</span>(<span class="at">paired_vs_tumor =</span> hb_w_t<span class="sc">$</span>test, <span class="at">paired_vs_normal =</span> hb_w_n<span class="sc">$</span>test, <span class="at">tumor_vs_normal =</span> hb_t_n<span class="sc">$</span>test)</span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(comparison_out, <span class="at">file =</span> <span class="fu">paste0</span>(dataset_id, <span class="st">"_compare_separate_vs_paired.rds"</span>))</span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(lmm_tumor,  <span class="fu">paste0</span>(dataset_id, <span class="st">"_tumorNet_LMM_results.csv"</span>),  <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(lmm_normal, <span class="fu">paste0</span>(dataset_id, <span class="st">"_normalNet_LMM_results.csv"</span>), <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">"Saved: "</span>, dataset_id, <span class="st">"_compare_separate_vs_paired.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Saved: GSE62043_compare_separate_vs_paired.rds</code></pre>
</div>
</div>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>