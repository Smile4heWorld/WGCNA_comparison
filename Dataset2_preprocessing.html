<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Dataset2_preprocessing</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Dataset2_preprocessing_files/libs/clipboard/clipboard.min.js"></script>
<script src="Dataset2_preprocessing_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="Dataset2_preprocessing_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="Dataset2_preprocessing_files/libs/quarto-html/popper.min.js"></script>
<script src="Dataset2_preprocessing_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Dataset2_preprocessing_files/libs/quarto-html/anchor.min.js"></script>
<link href="Dataset2_preprocessing_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Dataset2_preprocessing_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Dataset2_preprocessing_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Dataset2_preprocessing_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Dataset2_preprocessing_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Dataset2_preprocessing</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GEOquery)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Lade nötiges Paket: Biobase</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Lade nötiges Paket: BiocGenerics</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Lade nötiges Paket: generics</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attache Paket: 'generics'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Die folgenden Objekte sind maskiert von 'package:base':

    as.difftime, as.factor, as.ordered, intersect, is.element, setdiff,
    setequal, union</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attache Paket: 'BiocGenerics'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Die folgenden Objekte sind maskiert von 'package:stats':

    IQR, mad, sd, var, xtabs</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Die folgenden Objekte sind maskiert von 'package:base':

    anyDuplicated, aperm, append, as.data.frame, basename, cbind,
    colnames, dirname, do.call, duplicated, eval, evalq, Filter, Find,
    get, grep, grepl, is.unsorted, lapply, Map, mapply, match, mget,
    order, paste, pmax, pmax.int, pmin, pmin.int, Position, rank,
    rbind, Reduce, rownames, sapply, saveRDS, table, tapply, unique,
    unsplit, which.max, which.min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Welcome to Bioconductor

    Vignettes contain introductory material; view with
    'browseVignettes()'. To cite Bioconductor, see
    'citation("Biobase")', and for packages 'citation("pkgname")'.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting options('download.file.method.GEOquery'='auto')</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting options('GEOquery.inmemory.gpl'=FALSE)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(limma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attache Paket: 'limma'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Das folgende Objekt ist maskiert 'package:BiocGenerics':

    plotMA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(WGCNA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Paket 'WGCNA' wurde unter R Version 4.5.2 erstellt</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Lade nötiges Paket: dynamicTreeCut</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Paket 'dynamicTreeCut' wurde unter R Version 4.5.2 erstellt</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Lade nötiges Paket: fastcluster</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Paket 'fastcluster' wurde unter R Version 4.5.2 erstellt</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attache Paket: 'fastcluster'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Das folgende Objekt ist maskiert 'package:stats':

    hclust</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attache Paket: 'WGCNA'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Das folgende Objekt ist maskiert 'package:stats':

    cor</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attache Paket: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Das folgende Objekt ist maskiert 'package:nlme':

    collapse</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Das folgende Objekt ist maskiert 'package:Biobase':

    combine</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Die folgenden Objekte sind maskiert von 'package:BiocGenerics':

    combine, intersect, setdiff, setequal, union</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Das folgende Objekt ist maskiert 'package:generics':

    explain</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Die folgenden Objekte sind maskiert von 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Die folgenden Objekte sind maskiert von 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">disableWGCNAThreads</span>()</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>ctrl_lme <span class="ot">&lt;-</span> nlme<span class="sc">::</span><span class="fu">lmeControl</span>(</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">singular.ok =</span> <span class="cn">TRUE</span>,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">returnObject =</span> <span class="cn">TRUE</span>,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">opt =</span> <span class="st">"optim"</span>,</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">msMaxIter =</span> <span class="dv">200</span>,</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxIter =</span> <span class="dv">200</span>,</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">niterEM =</span> <span class="dv">50</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Download metadata + raw files</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>gse   <span class="ot">&lt;-</span> <span class="fu">getGEO</span>(<span class="st">"GSE62043"</span>, <span class="at">GSEMatrix =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Found 1 file(s)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>GSE62043_series_matrix.txt.gz</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>eset  <span class="ot">&lt;-</span> gse[[<span class="dv">1</span>]]</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>pheno <span class="ot">&lt;-</span> <span class="fu">pData</span>(eset)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(pheno) <span class="ot">&lt;-</span> pheno<span class="sc">$</span>geo_accession</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>baseDir <span class="ot">&lt;-</span> <span class="st">"GSE62043_raw"</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(baseDir, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="fu">getGEOSuppFiles</span>(<span class="st">"GSE62043"</span>, <span class="at">baseDir =</span> baseDir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using locally cached version of supplementary file(s) GSE62043 found here:
GSE62043_raw/GSE62043/GSE62043_RAW.tar </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                                             size isdir mode
GSE62043_raw/GSE62043/GSE62043_RAW.tar 1648834560 FALSE  666
                                                     mtime               ctime
GSE62043_raw/GSE62043/GSE62043_RAW.tar 2026-01-05 21:52:59 2026-01-05 21:48:21
                                                     atime exe uname
GSE62043_raw/GSE62043/GSE62043_RAW.tar 2026-01-06 08:27:46  no flori
                                             udomain
GSE62043_raw/GSE62043/GSE62043_RAW.tar UNICORN_THINK</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>gseDir  <span class="ot">&lt;-</span> <span class="fu">file.path</span>(baseDir, <span class="st">"GSE62043"</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>tarFile <span class="ot">&lt;-</span> <span class="fu">file.path</span>(gseDir, <span class="st">"GSE62043_RAW.tar"</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">file.exists</span>(tarFile))</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>rawDir <span class="ot">&lt;-</span> <span class="fu">file.path</span>(gseDir, <span class="st">"raw_txt"</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(rawDir, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="fu">untar</span>(tarFile, <span class="at">exdir =</span> rawDir)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>raw_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(rawDir, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.txt</span><span class="sc">\\</span><span class="st">.gz$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">length</span>(raw_files) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>gsm_from_file <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^(GSM</span><span class="sc">\\</span><span class="st">d+).*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, <span class="fu">basename</span>(raw_files))</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(gsm_from_file <span class="sc">%in%</span> <span class="fu">rownames</span>(pheno)))</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>pheno_raw <span class="ot">&lt;-</span> pheno[gsm_from_file, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Raw files:"</span>, <span class="fu">length</span>(raw_files), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Raw files: 100 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(raw_files)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "GSE62043_raw/GSE62043/raw_txt/GSM1518806_251485038123_S01_GE2-v5_10_Apr08_1_1.txt.gz"
[2] "GSE62043_raw/GSE62043/raw_txt/GSM1518807_251485038123_S01_GE2-v5_10_Apr08_1_2.txt.gz"
[3] "GSE62043_raw/GSE62043/raw_txt/GSM1518808_251485038123_S01_GE2-v5_10_Apr08_1_3.txt.gz"
[4] "GSE62043_raw/GSE62043/raw_txt/GSM1518809_251485038123_S01_GE2-v5_10_Apr08_1_4.txt.gz"
[5] "GSE62043_raw/GSE62043/raw_txt/GSM1518810_251485038124_S01_GE2-v5_10_Apr08_1_1.txt.gz"
[6] "GSE62043_raw/GSE62043/raw_txt/GSM1518811_251485038124_S01_GE2-v5_10_Apr08_1_2.txt.gz"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">grepl</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">.gz$"</span>, raw_files))) {</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"R.utils"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Please install R.utils: install.packages('R.utils')"</span>)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Decompressing gz files ..."</span>)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(raw_files, <span class="cf">function</span>(f) R.utils<span class="sc">::</span><span class="fu">gunzip</span>(f, <span class="at">remove =</span> <span class="cn">FALSE</span>, <span class="at">overwrite =</span> <span class="cn">TRUE</span>))</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  raw_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(rawDir, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.txt$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">length</span>(raw_files) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>  gsm_from_file <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^(GSM</span><span class="sc">\\</span><span class="st">d+).*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, <span class="fu">basename</span>(raw_files))</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">all</span>(gsm_from_file <span class="sc">%in%</span> <span class="fu">rownames</span>(pheno)))</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>  pheno_raw <span class="ot">&lt;-</span> pheno[gsm_from_file, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Raw files (txt):"</span>, <span class="fu">length</span>(raw_files), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(raw_files)</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Decompressing gz files ...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Raw files (txt): 100 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "GSE62043_raw/GSE62043/raw_txt/GSM1518806_251485038123_S01_GE2-v5_10_Apr08_1_1.txt"
[2] "GSE62043_raw/GSE62043/raw_txt/GSM1518807_251485038123_S01_GE2-v5_10_Apr08_1_2.txt"
[3] "GSE62043_raw/GSE62043/raw_txt/GSM1518808_251485038123_S01_GE2-v5_10_Apr08_1_3.txt"
[4] "GSE62043_raw/GSE62043/raw_txt/GSM1518809_251485038123_S01_GE2-v5_10_Apr08_1_4.txt"
[5] "GSE62043_raw/GSE62043/raw_txt/GSM1518810_251485038124_S01_GE2-v5_10_Apr08_1_1.txt"
[6] "GSE62043_raw/GSE62043/raw_txt/GSM1518811_251485038124_S01_GE2-v5_10_Apr08_1_2.txt"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Agilent 2-color raw + limma preprocessing</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>RG <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.maimages</span>(</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">files   =</span> raw_files,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">source  =</span> <span class="st">"agilent"</span>,</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">list</span>(</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">R  =</span> <span class="st">"rMedianSignal"</span>,</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">G  =</span> <span class="st">"gMedianSignal"</span>,</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">Rb =</span> <span class="st">"rBGMedianSignal"</span>,</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">Gb =</span> <span class="st">"gBGMedianSignal"</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Falling back to read.maimages(..., source='agilent') defaults:</span><span class="sc">\n</span><span class="st">"</span>, e<span class="sc">$</span>message)</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read.maimages</span>(<span class="at">files =</span> raw_files, <span class="at">source =</span> <span class="st">"agilent"</span>)</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Read GSE62043_raw/GSE62043/raw_txt/GSM1518806_251485038123_S01_GE2-v5_10_Apr08_1_1.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518807_251485038123_S01_GE2-v5_10_Apr08_1_2.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518808_251485038123_S01_GE2-v5_10_Apr08_1_3.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518809_251485038123_S01_GE2-v5_10_Apr08_1_4.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518810_251485038124_S01_GE2-v5_10_Apr08_1_1.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518811_251485038124_S01_GE2-v5_10_Apr08_1_2.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518812_251485038124_S01_GE2-v5_10_Apr08_1_3.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518813_251485038124_S01_GE2-v5_10_Apr08_1_4.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518814_251485038125_S01_GE2-v5_10_Apr08_1_1.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518815_251485038125_S01_GE2-v5_10_Apr08_1_2.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518816_251485038125_S01_GE2-v5_10_Apr08_1_3.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518817_251485038125_S01_GE2-v5_10_Apr08_1_4.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518818_251485038173_S01_GE2-v5_10_Apr08_1_1.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518819_251485038173_S01_GE2-v5_10_Apr08_1_2.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518820_251485038173_S01_GE2-v5_10_Apr08_1_3.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518821_251485038173_S01_GE2-v5_10_Apr08_1_4.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518822_251485038174_S01_GE2-v5_10_Apr08_1_1.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518823_251485038174_S01_GE2-v5_10_Apr08_1_2.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518824_251485038174_S01_GE2-v5_10_Apr08_1_3.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518825_251485038174_S01_GE2-v5_10_Apr08_1_4.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518826_251485038175_S01_GE2-v5_10_Apr08_1_1.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518827_251485038175_S01_GE2-v5_10_Apr08_1_2.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518828_251485038175_S01_GE2-v5_10_Apr08_1_3.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518829_251485038175_S01_GE2-v5_10_Apr08_1_4.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518830_251485038194_S01_GE2-v5_10_Apr08_1_1.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518831_251485038194_S01_GE2-v5_10_Apr08_1_2.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518832_251485038194_S01_GE2-v5_10_Apr08_1_3.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518833_251485038194_S01_GE2-v5_10_Apr08_1_4.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518834_251485038195_S01_GE2-v5_10_Apr08_1_1.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518835_251485038195_S01_GE2-v5_10_Apr08_1_2.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518836_251485038195_S01_GE2-v5_10_Apr08_1_3.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518837_251485038195_S01_GE2-v5_10_Apr08_1_4.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518838_251485038196_S01_GE2-v5_10_Apr08_1_1.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518839_251485038196_S01_GE2-v5_10_Apr08_1_2.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518840_251485038196_S01_GE2-v5_10_Apr08_1_3.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518841_251485038196_S01_GE2-v5_10_Apr08_1_4.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518842_251485039288_S01_GE2-v5_10_Apr08_1_1.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518843_251485039288_S01_GE2-v5_10_Apr08_1_2.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518844_251485039288_S01_GE2-v5_10_Apr08_1_3.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518845_251485039288_S01_GE2-v5_10_Apr08_1_4.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518846_251485039289_S01_GE2-v5_10_Apr08_1_1.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518847_251485039289_S01_GE2-v5_10_Apr08_1_2.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518848_251485039289_S01_GE2-v5_10_Apr08_1_3.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518849_251485039289_S01_GE2-v5_10_Apr08_1_4.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518850_251485039290_S01_GE2-v5_10_Apr08_1_1.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518851_251485039290_S01_GE2-v5_10_Apr08_1_2.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518852_251485039290_S01_GE2-v5_10_Apr08_1_3.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518853_251485039290_S01_GE2-v5_10_Apr08_1_4.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518854_251485039291_S01_GE2-v5_10_Apr08_1_1.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518855_251485039291_S01_GE2-v5_10_Apr08_1_2.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518856_251485039291_S01_GE2-v5_10_Apr08_1_3.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518857_251485039291_S01_GE2-v5_10_Apr08_1_4.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518858_251485039292_S01_GE2-v5_10_Apr08_1_1.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518859_251485039292_S01_GE2-v5_10_Apr08_1_2.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518860_251485039292_S01_GE2-v5_10_Apr08_1_3.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518861_251485039292_S01_GE2-v5_10_Apr08_1_4.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518862_251485039973_S01_GE2-v5_10_Apr08_1_1.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518863_251485039973_S01_GE2-v5_10_Apr08_1_2.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518864_251485039973_S01_GE2-v5_10_Apr08_1_3.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518865_251485039973_S01_GE2-v5_10_Apr08_1_4.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518866_251485039974_S01_GE2-v5_10_Apr08_1_1.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518867_251485039974_S01_GE2-v5_10_Apr08_1_2.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518868_251485040019_S01_GE2-v5_10_Apr08_1_1.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518869_251485040019_S01_GE2-v5_10_Apr08_1_2.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518870_251485040019_S01_GE2-v5_10_Apr08_1_3.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518871_251485040019_S01_GE2-v5_10_Apr08_1_4.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518872_251485040020_S01_GE2-v5_10_Apr08_1_1.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518873_251485040020_S01_GE2-v5_10_Apr08_1_2.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518874_251485040020_S01_GE2-v5_10_Apr08_1_3.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518875_251485040020_S01_GE2-v5_10_Apr08_1_4.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518876_251485040021_S01_GE2-v5_10_Apr08_1_1.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518877_251485040021_S01_GE2-v5_10_Apr08_1_2.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518878_251485040021_S01_GE2-v5_10_Apr08_1_3.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518879_251485040021_S01_GE2-v5_10_Apr08_1_4.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518880_251485040022_S01_GE2-v5_10_Apr08_1_1.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518881_251485040022_S01_GE2-v5_10_Apr08_1_2.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518882_251485040022_S01_GE2-v5_10_Apr08_1_3.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518883_251485040022_S01_GE2-v5_10_Apr08_1_4.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518884_251485040023_S01_GE2-v5_10_Apr08_1_1.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518885_251485040023_S01_GE2-v5_10_Apr08_1_2.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518886_251485040023_S01_GE2-v5_10_Apr08_1_3.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518887_251485040023_S01_GE2-v5_10_Apr08_1_4.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518888_251485042193_S01_GE2-v5_10_Apr08_1_1.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518889_251485042193_S01_GE2-v5_10_Apr08_1_2.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518890_251485042193_S01_GE2-v5_10_Apr08_1_3.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518891_251485042194_S01_GE2-v5_10_Apr08_1_1.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518892_251485042194_S01_GE2-v5_10_Apr08_1_2.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518893_251485042195_S01_GE2-v5_10_Apr08_1_1.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518894_251485042324_S01_GE2-v5_10_Apr08_1_1.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518895_251485042324_S01_GE2-v5_10_Apr08_1_2.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518896_251485042324_S01_GE2-v5_10_Apr08_1_3.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518897_251485042324_S01_GE2-v5_10_Apr08_1_4.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518898_251485042325_S01_GE2-v5_10_Apr08_1_1.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518899_251485042325_S01_GE2-v5_10_Apr08_1_2.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518900_251485042325_S01_GE2-v5_10_Apr08_1_3.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518901_251485042325_S01_GE2-v5_10_Apr08_1_4.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518902_251485042326_S01_GE2-v5_10_Apr08_1_1.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518903_251485042326_S01_GE2-v5_10_Apr08_1_2.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518904_251485042326_S01_GE2-v5_10_Apr08_1_3.txt 
Read GSE62043_raw/GSE62043/raw_txt/GSM1518905_251485042326_S01_GE2-v5_10_Apr08_1_4.txt </code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(RG<span class="sc">$</span>R) <span class="ot">&lt;-</span> gsm_from_file</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(RG<span class="sc">$</span>G) <span class="ot">&lt;-</span> gsm_from_file</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.null</span>(RG<span class="sc">$</span>genes), <span class="fu">nrow</span>(RG<span class="sc">$</span>genes) <span class="sc">==</span> <span class="fu">nrow</span>(RG<span class="sc">$</span>R))</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="st">"ProbeName"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(RG<span class="sc">$</span>genes))</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>probe_id <span class="ot">&lt;-</span> <span class="fu">as.character</span>(RG<span class="sc">$</span>genes<span class="sc">$</span>ProbeName)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">length</span>(probe_id) <span class="sc">==</span> <span class="fu">nrow</span>(RG<span class="sc">$</span>R))</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(RG<span class="sc">$</span>R) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(RG<span class="sc">$</span>G) <span class="ot">&lt;-</span> probe_id</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>RGb <span class="ot">&lt;-</span> <span class="fu">backgroundCorrect</span>(RG, <span class="at">method =</span> <span class="st">"normexp"</span>, <span class="at">offset =</span> <span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Array 1 corrected
Array 2 corrected
Array 3 corrected
Array 4 corrected
Array 5 corrected
Array 6 corrected
Array 7 corrected
Array 8 corrected
Array 9 corrected
Array 10 corrected
Array 11 corrected
Array 12 corrected
Array 13 corrected
Array 14 corrected
Array 15 corrected
Array 16 corrected
Array 17 corrected
Array 18 corrected
Array 19 corrected
Array 20 corrected
Array 21 corrected
Array 22 corrected
Array 23 corrected
Array 24 corrected
Array 25 corrected
Array 26 corrected
Array 27 corrected
Array 28 corrected
Array 29 corrected
Array 30 corrected
Array 31 corrected
Array 32 corrected
Array 33 corrected
Array 34 corrected
Array 35 corrected
Array 36 corrected
Array 37 corrected
Array 38 corrected
Array 39 corrected
Array 40 corrected
Array 41 corrected
Array 42 corrected
Array 43 corrected
Array 44 corrected
Array 45 corrected
Array 46 corrected
Array 47 corrected
Array 48 corrected
Array 49 corrected
Array 50 corrected
Array 51 corrected
Array 52 corrected
Array 53 corrected
Array 54 corrected
Array 55 corrected
Array 56 corrected
Array 57 corrected
Array 58 corrected
Array 59 corrected
Array 60 corrected
Array 61 corrected
Array 62 corrected
Array 63 corrected
Array 64 corrected
Array 65 corrected
Array 66 corrected
Array 67 corrected
Array 68 corrected
Array 69 corrected
Array 70 corrected
Array 71 corrected
Array 72 corrected
Array 73 corrected
Array 74 corrected
Array 75 corrected
Array 76 corrected
Array 77 corrected
Array 78 corrected
Array 79 corrected
Array 80 corrected
Array 81 corrected
Array 82 corrected
Array 83 corrected
Array 84 corrected
Array 85 corrected
Array 86 corrected
Array 87 corrected
Array 88 corrected
Array 89 corrected
Array 90 corrected
Array 91 corrected
Array 92 corrected
Array 93 corrected
Array 94 corrected
Array 95 corrected
Array 96 corrected
Array 97 corrected
Array 98 corrected
Array 99 corrected
Array 100 corrected
Array 1 corrected
Array 2 corrected
Array 3 corrected
Array 4 corrected
Array 5 corrected
Array 6 corrected
Array 7 corrected
Array 8 corrected
Array 9 corrected
Array 10 corrected
Array 11 corrected
Array 12 corrected
Array 13 corrected
Array 14 corrected
Array 15 corrected
Array 16 corrected
Array 17 corrected
Array 18 corrected
Array 19 corrected
Array 20 corrected
Array 21 corrected
Array 22 corrected
Array 23 corrected
Array 24 corrected
Array 25 corrected
Array 26 corrected
Array 27 corrected
Array 28 corrected
Array 29 corrected
Array 30 corrected
Array 31 corrected
Array 32 corrected
Array 33 corrected
Array 34 corrected
Array 35 corrected
Array 36 corrected
Array 37 corrected
Array 38 corrected
Array 39 corrected
Array 40 corrected
Array 41 corrected
Array 42 corrected
Array 43 corrected
Array 44 corrected
Array 45 corrected
Array 46 corrected
Array 47 corrected
Array 48 corrected
Array 49 corrected
Array 50 corrected
Array 51 corrected
Array 52 corrected
Array 53 corrected
Array 54 corrected
Array 55 corrected
Array 56 corrected
Array 57 corrected
Array 58 corrected
Array 59 corrected
Array 60 corrected
Array 61 corrected
Array 62 corrected
Array 63 corrected
Array 64 corrected
Array 65 corrected
Array 66 corrected
Array 67 corrected
Array 68 corrected
Array 69 corrected
Array 70 corrected
Array 71 corrected
Array 72 corrected
Array 73 corrected
Array 74 corrected
Array 75 corrected
Array 76 corrected
Array 77 corrected
Array 78 corrected
Array 79 corrected
Array 80 corrected
Array 81 corrected
Array 82 corrected
Array 83 corrected
Array 84 corrected
Array 85 corrected
Array 86 corrected
Array 87 corrected
Array 88 corrected
Array 89 corrected
Array 90 corrected
Array 91 corrected
Array 92 corrected
Array 93 corrected
Array 94 corrected
Array 95 corrected
Array 96 corrected
Array 97 corrected
Array 98 corrected
Array 99 corrected
Array 100 corrected</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>MA  <span class="ot">&lt;-</span> <span class="fu">normalizeWithinArrays</span>(RGb, <span class="at">method =</span> <span class="st">"loess"</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>MA  <span class="ot">&lt;-</span> <span class="fu">normalizeBetweenArrays</span>(MA, <span class="at">method =</span> <span class="st">"Aquantile"</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>logR <span class="ot">&lt;-</span> MA<span class="sc">$</span>A <span class="sc">+</span> MA<span class="sc">$</span>M<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>logG <span class="ot">&lt;-</span> MA<span class="sc">$</span>A <span class="sc">-</span> MA<span class="sc">$</span>M<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(logR) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(RG<span class="sc">$</span>R)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(logG) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(RG<span class="sc">$</span>G)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(logR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 45015   100</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>keep_feat <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.na</span>(probe_id) <span class="sc">&amp;</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">grepl</span>(<span class="st">"^A_"</span>, probe_id) <span class="sc">&amp;</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">is.null</span>(RG<span class="sc">$</span>genes<span class="sc">$</span>ControlType) <span class="sc">|</span> RG<span class="sc">$</span>genes<span class="sc">$</span>ControlType <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>logR <span class="ot">&lt;-</span> logR[keep_feat, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>logG <span class="ot">&lt;-</span> logG[keep_feat, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(logR) <span class="ot">&lt;-</span> probe_id[keep_feat]</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(logG) <span class="ot">&lt;-</span> probe_id[keep_feat]</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">rownames</span>(logR))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "A_24_P66027"  "A_32_P77178"  "A_23_P212522" "A_24_P934473" "A_24_P9671"  
[6] "A_32_P29551" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build GSM_T / GSM_N mapping</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">tolower</span>(pheno_raw<span class="sc">$</span>label_ch1) <span class="sc">==</span> <span class="st">"cy5"</span>),</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">all</span>(<span class="fu">tolower</span>(pheno_raw<span class="sc">$</span>label_ch2) <span class="sc">==</span> <span class="st">"cy3"</span>))</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>normal_in_ch2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">grepl</span>(<span class="st">"normal|adjacent"</span>, pheno_raw<span class="sc">$</span><span class="st">`</span><span class="at">tissue:ch2</span><span class="st">`</span>, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>normal_in_ch1 <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">grepl</span>(<span class="st">"normal|adjacent"</span>, pheno_raw<span class="sc">$</span><span class="st">`</span><span class="at">tissue:ch1</span><span class="st">`</span>, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (normal_in_ch2 <span class="sc">&gt;</span> normal_in_ch1) <span class="fu">message</span>(<span class="st">"Metadata also suggests ch2 is normal more often."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Metadata also suggests ch2 is normal more often.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>expr_raw <span class="ot">&lt;-</span> <span class="fu">cbind</span>(logR, logG)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(expr_raw) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">paste0</span>(gsm_from_file, <span class="st">"_T"</span>),</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">paste0</span>(gsm_from_file, <span class="st">"_N"</span>))</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>do_final_quantile <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>expr_norm <span class="ot">&lt;-</span> <span class="cf">if</span> (do_final_quantile) {</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">normalizeBetweenArrays</span>(expr_raw, <span class="at">method =</span> <span class="st">"quantile"</span>)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>  expr_raw</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(expr_norm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 43376   200</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Annotation + filtering + collapse probes -&gt; gene symbols</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>gpl_tbl <span class="ot">&lt;-</span> <span class="fu">Table</span>(<span class="fu">getGEO</span>(<span class="st">"GPL6480"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using locally cached version of GPL6480 found here:
C:\Users\flori\AppData\Local\Temp\RtmpUP4JHj/GPL6480.soft.gz </code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>annot <span class="ot">&lt;-</span> gpl_tbl[, <span class="fu">c</span>(<span class="st">"ID"</span>, <span class="st">"GENE_SYMBOL"</span>), drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(annot) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"probe_id"</span>, <span class="st">"symbol"</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>probe_ids <span class="ot">&lt;-</span> <span class="fu">rownames</span>(expr_norm)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>annot2 <span class="ot">&lt;-</span> annot[<span class="fu">match</span>(probe_ids, annot<span class="sc">$</span>probe_id), , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>annot2<span class="sc">$</span>symbol <span class="ot">&lt;-</span> <span class="fu">trimws</span>(<span class="fu">sub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s*///.*$"</span>, <span class="st">""</span>, <span class="fu">as.character</span>(annot2<span class="sc">$</span>symbol)))</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>keep_probes <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.na</span>(annot2<span class="sc">$</span>symbol) <span class="sc">&amp;</span> annot2<span class="sc">$</span>symbol <span class="sc">!=</span> <span class="st">""</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>expr_gene <span class="ot">&lt;-</span> limma<span class="sc">::</span><span class="fu">avereps</span>(expr_norm[keep_probes, , <span class="at">drop =</span> <span class="cn">FALSE</span>],</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>                            <span class="at">ID =</span> annot2<span class="sc">$</span>symbol[keep_probes])</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Probes (raw):"</span>, <span class="fu">nrow</span>(expr_norm), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Probes (raw): 43376 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Probes kept :"</span>, <span class="fu">sum</span>(keep_probes), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Probes kept : 33285 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Genes final :"</span>, <span class="fu">nrow</span>(expr_gene), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Genes final : 19595 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build traits (paired design + Age + Gender)</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>sid  <span class="ot">&lt;-</span> <span class="fu">colnames</span>(expr_gene)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>GSM  <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"_(T|N)$"</span>, <span class="st">""</span>, sid)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>isT  <span class="ot">&lt;-</span> <span class="fu">grepl</span>(<span class="st">"_T$"</span>, sid)</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">match</span>(GSM, <span class="fu">rownames</span>(pheno_raw))</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>Age <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">as.numeric</span>(pheno_raw<span class="sc">$</span><span class="st">`</span><span class="at">age:ch1</span><span class="st">`</span>[idx]))</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(pheno_raw<span class="sc">$</span><span class="st">`</span><span class="at">gender:ch1</span><span class="st">`</span> <span class="sc">==</span> pheno_raw<span class="sc">$</span><span class="st">`</span><span class="at">gender:ch2</span><span class="st">`</span>))</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>g_raw  <span class="ot">&lt;-</span> pheno_raw<span class="sc">$</span><span class="st">`</span><span class="at">gender:ch1</span><span class="st">`</span>[idx]</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>Gender <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"^f"</span>, g_raw, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>), <span class="st">"F"</span>,</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"^m"</span>, g_raw, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>), <span class="st">"M"</span>, <span class="cn">NA_character_</span>))</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>sample_info <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_id  =</span> sid,</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">GSM        =</span> GSM,</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">patient_id =</span> GSM,</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">condition  =</span> <span class="fu">ifelse</span>(isT, <span class="st">"tumor"</span>, <span class="st">"normal"</span>),</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">tumour     =</span> <span class="fu">as.integer</span>(isT),</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">Age        =</span> Age,</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">Gender     =</span> Gender,</span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names  =</span> sid,</span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a>expr_gene <span class="ot">&lt;-</span> expr_gene[, <span class="fu">rownames</span>(sample_info)]</span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">identical</span>(<span class="fu">colnames</span>(expr_gene), <span class="fu">rownames</span>(sample_info)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># QC: PCA, Z.k outliers, dendrogram &amp; paired removal</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>expr_t <span class="ot">&lt;-</span> <span class="fu">t</span>(expr_gene)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">identical</span>(<span class="fu">rownames</span>(expr_t), <span class="fu">rownames</span>(sample_info)))</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>pca  <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(expr_t, <span class="at">scale. =</span> <span class="cn">TRUE</span>)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>labs <span class="ot">&lt;-</span> <span class="fu">rownames</span>(expr_t)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>grp  <span class="ot">&lt;-</span> <span class="fu">factor</span>(sample_info<span class="sc">$</span>condition, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"normal"</span>,<span class="st">"tumor"</span>))</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>pal  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">normal =</span> <span class="st">"#1B9E77"</span>, <span class="at">tumor =</span> <span class="st">"#D95F02"</span>)</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> pal[grp]</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>pv <span class="ot">&lt;-</span> <span class="fu">summary</span>(pca)<span class="sc">$</span>importance[<span class="st">"Proportion of Variance"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pca<span class="sc">$</span>x[,<span class="dv">1</span>], pca<span class="sc">$</span>x[,<span class="dv">2</span>],</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">"n"</span>,</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="fu">sprintf</span>(<span class="st">"PC1 (%.1f%%)"</span>, <span class="dv">100</span><span class="sc">*</span>pv[<span class="dv">1</span>]),</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="fu">sprintf</span>(<span class="st">"PC2 (%.1f%%)"</span>, <span class="dv">100</span><span class="sc">*</span>pv[<span class="dv">2</span>]),</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"PCA (tumor vs normal)"</span>)</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(pca<span class="sc">$</span>x[,<span class="dv">1</span>], pca<span class="sc">$</span>x[,<span class="dv">2</span>], <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">col =</span> cols)</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(pca<span class="sc">$</span>x[,<span class="dv">1</span>], pca<span class="sc">$</span>x[,<span class="dv">2</span>], <span class="at">labels =</span> labs, <span class="at">pos =</span> <span class="dv">3</span>, <span class="at">cex =</span> <span class="fl">0.55</span>, <span class="at">col =</span> cols, <span class="at">offset =</span> <span class="fl">0.1</span>)</span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">names</span>(pal), <span class="at">col =</span> <span class="fu">unname</span>(pal), <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">title =</span> <span class="st">"Condition"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Dataset2_preprocessing_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>C.samp <span class="ot">&lt;-</span> <span class="fu">cor</span>(<span class="fu">t</span>(expr_t), <span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>A.samp <span class="ot">&lt;-</span> <span class="fu">abs</span>(C.samp); <span class="fu">diag</span>(A.samp) <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>k.samp <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(A.samp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>Z.k    <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(k.samp))</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Z.k) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(expr_t)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>thr <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">2.5</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>outliers <span class="ot">&lt;-</span> <span class="fu">names</span>(Z.k)[Z.k <span class="sc">&lt;</span> thr]</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>cols_z <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(labs <span class="sc">%in%</span> outliers, <span class="st">"red"</span>, <span class="st">"black"</span>)</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pca<span class="sc">$</span>x[,<span class="dv">1</span>], pca<span class="sc">$</span>x[,<span class="dv">2</span>],</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">"n"</span>,</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="fu">sprintf</span>(<span class="st">"PC1 (%.1f%%)"</span>, <span class="dv">100</span><span class="sc">*</span>pv[<span class="dv">1</span>]),</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="fu">sprintf</span>(<span class="st">"PC2 (%.1f%%)"</span>, <span class="dv">100</span><span class="sc">*</span>pv[<span class="dv">2</span>]),</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">sprintf</span>(<span class="st">"PCA (Z.k &lt; %.1f in red)"</span>, thr))</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(pca<span class="sc">$</span>x[,<span class="dv">1</span>], pca<span class="sc">$</span>x[,<span class="dv">2</span>], <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">col =</span> cols_z)</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(pca<span class="sc">$</span>x[,<span class="dv">1</span>], pca<span class="sc">$</span>x[,<span class="dv">2</span>], <span class="at">labels =</span> labs, <span class="at">pos =</span> <span class="dv">3</span>, <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">col =</span> cols_z, <span class="at">offset =</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Dataset2_preprocessing_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>gsm_outliers <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">sub</span>(<span class="st">"_(T|N)$"</span>, <span class="st">""</span>, outliers))</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(gsm_outliers)) {</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Z.k outlier GSMs:</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">paste</span>(gsm_outliers, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Z.k outlier GSMs:
 GSM1518815, GSM1518820, GSM1518844, GSM1518848, GSM1518858, GSM1518895, GSM1518814 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>Zk_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">sample =</span> <span class="fu">names</span>(Z.k), <span class="at">Z.k =</span> Z.k, <span class="at">GSM =</span> <span class="fu">sub</span>(<span class="st">"_(T|N)$"</span>,<span class="st">""</span>, <span class="fu">names</span>(Z.k)))</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>Zk_table <span class="ot">&lt;-</span> Zk_table[<span class="fu">order</span>(Zk_table<span class="sc">$</span>Z.k), ]</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(Zk_table, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   sample       Z.k        GSM
GSM1518858_T GSM1518858_T -4.694365 GSM1518858
GSM1518895_T GSM1518895_T -3.937470 GSM1518895
GSM1518814_N GSM1518814_N -3.870970 GSM1518814
GSM1518820_T GSM1518820_T -2.994826 GSM1518820
GSM1518815_T GSM1518815_T -2.944760 GSM1518815
GSM1518848_T GSM1518848_T -2.909944 GSM1518848
GSM1518844_T GSM1518844_T -2.502973 GSM1518844
GSM1518898_T GSM1518898_T -2.435598 GSM1518898
GSM1518852_T GSM1518852_T -2.338534 GSM1518852
GSM1518824_T GSM1518824_T -2.183134 GSM1518824</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>d  <span class="ot">&lt;-</span> <span class="fu">as.dist</span>(<span class="dv">1</span> <span class="sc">-</span> C.samp)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>hc <span class="ot">&lt;-</span> <span class="fu">hclust</span>(d, <span class="at">method =</span> <span class="st">"average"</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hc, <span class="at">labels =</span> <span class="cn">FALSE</span>, <span class="at">main =</span> <span class="st">"Sample clustering (1 - Pearson r)"</span>, <span class="at">sub =</span> <span class="st">""</span>, <span class="at">xlab =</span> <span class="st">""</span>)</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(gsm_outliers)) {</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  targets_expanded <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(<span class="fu">paste0</span>(gsm_outliers, <span class="st">"_T"</span>),</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">paste0</span>(gsm_outliers, <span class="st">"_N"</span>)))</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>  leaf_labels_ordered <span class="ot">&lt;-</span> <span class="fu">rownames</span>(C.samp)[hc<span class="sc">$</span>order]</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>  found <span class="ot">&lt;-</span> <span class="fu">intersect</span>(targets_expanded, leaf_labels_ordered)</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>  x_out <span class="ot">&lt;-</span> <span class="fu">match</span>(found, leaf_labels_ordered)</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(x_out)) {</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>    old_xpd <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">xpd =</span> <span class="cn">NA</span>)</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">on.exit</span>(<span class="fu">par</span>(<span class="at">xpd =</span> old_xpd), <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>    yb <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="st">"usr"</span>)[<span class="dv">3</span>]</span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(x_out, <span class="fu">rep</span>(yb, <span class="fu">length</span>(x_out)), <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">text</span>(x_out, <span class="fu">rep</span>(yb, <span class="fu">length</span>(x_out)),</span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">labels =</span> found, <span class="at">srt =</span> <span class="dv">90</span>, <span class="at">adj =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">cex =</span> <span class="fl">0.6</span>)</span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"None of the outlier GSMs matched the plotted leaves."</span>)</span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Dataset2_preprocessing_files/figure-html/unnamed-chunk-6-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(outliers)) {</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  flagged_patients <span class="ot">&lt;-</span> <span class="fu">unique</span>(sample_info<span class="sc">$</span>patient_id[<span class="fu">match</span>(outliers, <span class="fu">rownames</span>(sample_info))])</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  to_drop <span class="ot">&lt;-</span> <span class="fu">rownames</span>(sample_info)[sample_info<span class="sc">$</span>patient_id <span class="sc">%in%</span> flagged_patients]</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Removing"</span>, <span class="fu">length</span>(flagged_patients), <span class="st">"patient(s),"</span>,</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">length</span>(to_drop), <span class="st">"sample(s):</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">paste</span>(to_drop, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  expr_gene   <span class="ot">&lt;-</span> expr_gene[, <span class="sc">!</span>(<span class="fu">colnames</span>(expr_gene) <span class="sc">%in%</span> to_drop), drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  sample_info <span class="ot">&lt;-</span> sample_info[<span class="sc">!</span>(<span class="fu">rownames</span>(sample_info) <span class="sc">%in%</span> to_drop), , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">identical</span>(<span class="fu">colnames</span>(expr_gene), <span class="fu">rownames</span>(sample_info)))</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"No samples removed (no Z.k outliers below"</span>, thr, <span class="st">").</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Removing 7 patient(s), 14 sample(s):
 GSM1518814_T, GSM1518815_T, GSM1518820_T, GSM1518844_T, GSM1518848_T, GSM1518858_T, GSM1518895_T, GSM1518814_N, GSM1518815_N, GSM1518820_N, GSM1518844_N, GSM1518848_N, GSM1518858_N, GSM1518895_N </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save cleaned dataset to .RData</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">exists</span>(<span class="st">"expr_gene"</span>), <span class="fu">exists</span>(<span class="st">"sample_info"</span>))</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>datExpr0 <span class="ot">&lt;-</span> <span class="fu">t</span>(expr_gene)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">identical</span>(<span class="fu">rownames</span>(datExpr0), <span class="fu">rownames</span>(sample_info)))</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"Z.k"</span>))          Z.k <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">numeric</span>(<span class="dv">0</span>), <span class="fu">character</span>(<span class="dv">0</span>))</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"thr"</span>))          thr <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">2.5</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"outliers"</span>))     outliers <span class="ot">&lt;-</span> <span class="fu">character</span>(<span class="dv">0</span>)</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"gsm_outliers"</span>)) gsm_outliers <span class="ot">&lt;-</span> <span class="fu">character</span>(<span class="dv">0</span>)</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>meta_kept <span class="ot">&lt;-</span> pheno_raw[<span class="fu">unique</span>(sample_info<span class="sc">$</span>GSM), , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>sample_traits <span class="ot">&lt;-</span> sample_info[, <span class="fu">c</span>(<span class="st">"patient_id"</span>,<span class="st">"tumour"</span>,<span class="st">"Age"</span>,<span class="st">"Gender"</span>), drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>info <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">created       =</span> <span class="fu">Sys.time</span>(),</span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">description   =</span> <span class="st">"GSE62043 gene-level expression after Agilent 2-color preprocessing and paired outlier removal via sample connectivity (Z.k)."</span>,</span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">R_version     =</span> R.version.string,</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_genes       =</span> <span class="fu">nrow</span>(expr_gene),</span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_samples     =</span> <span class="fu">ncol</span>(expr_gene),</span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">zk_threshold  =</span> thr,</span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">removed_full  =</span> outliers,</span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">removed_GSM   =</span> gsm_outliers</span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"GSE62043_clean_noOutliers_%s.RData"</span>, <span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">"%Y%m%d"</span>))</span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(</span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true" tabindex="-1"></a>  expr_gene,</span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true" tabindex="-1"></a>  sample_info,</span>
<span id="cb79-30"><a href="#cb79-30" aria-hidden="true" tabindex="-1"></a>  sample_traits,</span>
<span id="cb79-31"><a href="#cb79-31" aria-hidden="true" tabindex="-1"></a>  datExpr0,</span>
<span id="cb79-32"><a href="#cb79-32" aria-hidden="true" tabindex="-1"></a>  Z.k, thr,</span>
<span id="cb79-33"><a href="#cb79-33" aria-hidden="true" tabindex="-1"></a>  outliers,</span>
<span id="cb79-34"><a href="#cb79-34" aria-hidden="true" tabindex="-1"></a>  gsm_outliers,</span>
<span id="cb79-35"><a href="#cb79-35" aria-hidden="true" tabindex="-1"></a>  meta_kept,</span>
<span id="cb79-36"><a href="#cb79-36" aria-hidden="true" tabindex="-1"></a>  info,</span>
<span id="cb79-37"><a href="#cb79-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> outfile,</span>
<span id="cb79-38"><a href="#cb79-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">compress =</span> <span class="st">"xz"</span></span>
<span id="cb79-39"><a href="#cb79-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb79-40"><a href="#cb79-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-41"><a href="#cb79-41" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Saved cleaned dataset to:"</span>, outfile, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Saved cleaned dataset to: GSE62043_clean_noOutliers_20260106.RData </code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Dims expr_gene (genes x samples):"</span>, <span class="fu">nrow</span>(expr_gene), <span class="st">"x"</span>, <span class="fu">ncol</span>(expr_gene), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dims expr_gene (genes x samples): 19595 x 186 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Samples removed (GSM):"</span>, <span class="fu">ifelse</span>(<span class="fu">length</span>(gsm_outliers), <span class="fu">paste</span>(gsm_outliers, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"none"</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Samples removed (GSM): GSM1518815, GSM1518820, GSM1518844, GSM1518848, GSM1518858, GSM1518895, GSM1518814 </code></pre>
</div>
</div>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>